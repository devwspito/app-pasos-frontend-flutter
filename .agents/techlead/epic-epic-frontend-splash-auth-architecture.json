{
  "_metadata": {
    "agentType": "techlead",
    "taskId": "1bb751c1ac1b94470511c071",
    "timestamp": "2026-01-31T17:31:13.512Z",
    "phase": "techlead",
    "epicId": "epic-frontend-splash-auth",
    "savedAt": "2026-01-31T17:31:13.513Z",
    "version": "1.0"
  },
  "data": {
    "epicId": "epic-frontend-splash-auth",
    "storiesCount": 2,
    "architecture": "## Architecture Overview\n\nThis epic implements a SplashPage that serves as the entry point for the app, handling initial auth state checking.\n\n### Component Structure\n```\nlib/\nâ”œâ”€â”€ features/\nâ”‚   â””â”€â”€ splash/\nâ”‚       â””â”€â”€ presentation/\nâ”‚           â””â”€â”€ pages/\nâ”‚               â””â”€â”€ splash_page.dart  â† NEW (Story 1)\nâ””â”€â”€ core/\n    â””â”€â”€ router/\n        â””â”€â”€ app_router.dart          â† MODIFIED (Story 2)\n```\n\n### Data Flow\n```\nApp Launch â†’ SplashPage.initState()\n                â†“\n         Future.delayed(1.5s)\n                â†“\n    sl<SecureStorageService>().isAuthenticated()\n                â†“\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â†“               â†“\n    (true)          (false)\n        â†“               â†“\n  go(/dashboard)   go(/login)\n```\n\n### Key Patterns\n1. **Service Locator Pattern**: Use `sl<SecureStorageService>()` from get_it\n2. **GoRouter Navigation**: Use `context.go(RouteNames.xxx)` for navigation\n3. **Mounted State Check**: Always check `if (!mounted) return` before setState or navigation after async\n4. **StatefulWidget for Lifecycle**: Use initState() to trigger auth check on mount\n\n### Verification Commands\n- **Typecheck**: `flutter analyze`\n- **Build**: `flutter build apk --debug`\n- **Test**: `flutter test` (if tests exist)",
    "stories": [
      {
        "id": "epic-frontend-splash-auth-story-1",
        "title": "Create SplashPage in lib/features/splash/presentation/pages/splash_page.dart",
        "description": "Create a new SplashPage widget that:\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY create files listed in filesToCreate\n- You can ONLY read files listed in filesToRead for context\n\nğŸ“ **FILES:**\n- Read: lib/core/storage/secure_storage_service.dart, lib/shared/widgets/loading_indicator.dart, lib/core/router/route_names.dart, lib/core/constants/app_constants.dart, lib/core/di/injection_container.dart\n- Create: lib/features/splash/presentation/pages/splash_page.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Use `sl<SecureStorageService>()` from `package:app_pasos_frontend/core/di/injection_container.dart` to access storage\n- Use `await sl<SecureStorageService>().isAuthenticated()` to check if token exists\n- Use `context.go(RouteNames.dashboard)` for navigation to dashboard\n- Use `context.go(RouteNames.login)` for navigation to login\n- Use `LoadingIndicator` widget from `package:app_pasos_frontend/shared/widgets/loading_indicator.dart`\n- Use `AppConstants.appName` for branding text\n- Follow page pattern from LoginPage: StatelessWidget â†’ Scaffold â†’ body with Column\n\nğŸ“¦ **REQUIRED STRUCTURE:**\n```dart\nclass SplashPage extends StatefulWidget {\n  const SplashPage({super.key});\n  @override\n  State<SplashPage> createState() => _SplashPageState();\n}\n\nclass _SplashPageState extends State<SplashPage> {\n  @override\n  void initState() {\n    super.initState();\n    _checkAuthAndNavigate();\n  }\n  \n  Future<void> _checkAuthAndNavigate() async {\n    // Minimum splash duration for branding\n    await Future.delayed(const Duration(milliseconds: 1500));\n    if (!mounted) return;\n    \n    final isAuthenticated = await sl<SecureStorageService>().isAuthenticated();\n    if (!mounted) return;\n    \n    if (isAuthenticated) {\n      context.go(RouteNames.dashboard);\n    } else {\n      context.go(RouteNames.login);\n    }\n  }\n}\n```\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- Do NOT use `Navigator.push()` - use `context.go()` from go_router\n- Do NOT create a new SecureStorageService instance - use `sl<SecureStorageService>()`\n- Do NOT hardcode route paths like '/dashboard' - use RouteNames.dashboard\n- Do NOT use placeholder text like 'Coming Soon' or 'TODO'\n- Do NOT create any files outside of filesToCreate\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n- Display app logo/icon (Icons.directions_walk or similar) centered\n- Display 'App Pasos' title using AppConstants.appName\n- Display LoadingIndicator widget below the title\n- Use Theme.of(context).colorScheme.primary for icon/text colors\n- Check auth status after minimum 1.5 second delay\n- Navigate to /dashboard if authenticated\n- Navigate to /login if not authenticated\n- Handle mounted state to prevent setState after dispose\n\nğŸ§ª **VERIFICATION:**\n- flutter analyze lib/features/splash/presentation/pages/splash_page.dart\n- flutter build apk --debug (should compile without errors)",
        "epicId": "epic-frontend-splash-auth",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/core/storage/secure_storage_service.dart",
          "lib/shared/widgets/loading_indicator.dart",
          "lib/core/router/route_names.dart",
          "lib/core/constants/app_constants.dart",
          "lib/core/di/injection_container.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/features/splash/presentation/pages/splash_page.dart"
        ],
        "acceptanceCriteria": [
          "Given the app launches, When SplashPage mounts, Then it displays App Pasos logo and loading indicator",
          "Given the splash screen is shown, When 1.5 seconds pass and token EXISTS in SecureStorage, Then user navigates to /dashboard",
          "Given the splash screen is shown, When 1.5 seconds pass and NO token exists, Then user navigates to /login",
          "Given the splash animation is running, When user closes app, Then no setState is called after dispose (mounted check)",
          "Given the code is written, When running flutter analyze, Then zero errors are reported"
        ]
      },
      {
        "id": "epic-frontend-splash-auth-story-2",
        "title": "Replace FoundationReadyScreen with SplashPage in lib/core/router/app_router.dart",
        "description": "Modify app_router.dart to use the new SplashPage for the home route and remove the FoundationReadyScreen class.\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY modify files listed in filesToModify\n- You can ONLY read files listed in filesToRead for context\n\nğŸ“ **FILES:**\n- Read: lib/features/splash/presentation/pages/splash_page.dart\n- Modify: lib/core/router/app_router.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Add import: `import 'package:app_pasos_frontend/features/splash/presentation/pages/splash_page.dart';`\n- Replace the home route builder to use `const SplashPage()` instead of `const FoundationReadyScreen()`\n- Keep all other routes unchanged\n- Follow existing import organization (alphabetical, grouped by package)\n\nğŸ“¦ **EXACT CHANGES REQUIRED:**\n\n1. **Add import at top** (around line 10-17, with other page imports):\n```dart\nimport 'package:app_pasos_frontend/features/splash/presentation/pages/splash_page.dart';\n```\n\n2. **Modify home route** (around line 188-192):\n```dart\n// BEFORE:\nGoRoute(\n  path: RouteNames.home,\n  name: 'home',\n  builder: (context, state) => const FoundationReadyScreen(),\n),\n\n// AFTER:\nGoRoute(\n  path: RouteNames.home,\n  name: 'home',\n  builder: (context, state) => const SplashPage(),\n),\n```\n\n3. **DELETE FoundationReadyScreen class** (lines 443-497):\nRemove the entire `FoundationReadyScreen` class definition.\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- Do NOT remove or modify _PlaceholderScreen class - it's still used by profile/settings\n- Do NOT remove or modify _ErrorScreen class - it's used by error handling\n- Do NOT change any other routes besides the home route\n- Do NOT add BlocProvider around SplashPage - it doesn't need one\n- Do NOT modify the redirect logic - it's correct as-is\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n- Home route (/) renders SplashPage instead of FoundationReadyScreen\n- FoundationReadyScreen class is completely removed from the file\n- All other routes remain unchanged\n- No compilation errors\n- Import is added in proper location with other page imports\n\nğŸ§ª **VERIFICATION:**\n- flutter analyze lib/core/router/app_router.dart\n- flutter build apk --debug (should compile without errors)\n- Verify FoundationReadyScreen class no longer exists in file",
        "epicId": "epic-frontend-splash-auth",
        "priority": 2,
        "estimatedComplexity": "simple",
        "dependencies": [
          "epic-frontend-splash-auth-story-1"
        ],
        "status": "pending",
        "filesToRead": [
          "lib/features/splash/presentation/pages/splash_page.dart"
        ],
        "filesToModify": [
          "lib/core/router/app_router.dart"
        ],
        "filesToCreate": [],
        "acceptanceCriteria": [
          "Given app_router.dart is modified, When checking imports, Then SplashPage is imported from features/splash/presentation/pages/splash_page.dart",
          "Given the home route is checked, When builder is called, Then it returns SplashPage() not FoundationReadyScreen()",
          "Given the file is searched, When looking for FoundationReadyScreen class, Then it no longer exists in the file",
          "Given the code is written, When running flutter analyze, Then zero errors are reported",
          "Given the app builds, When launching, Then splash screen appears first"
        ]
      }
    ]
  }
}