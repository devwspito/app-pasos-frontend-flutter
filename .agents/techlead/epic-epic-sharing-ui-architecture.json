{
  "_metadata": {
    "agentType": "techlead",
    "taskId": "2c9e212b85d8a72c8a4d95bf",
    "timestamp": "2026-01-29T14:04:25.098Z",
    "phase": "techlead",
    "epicId": "epic-sharing-ui",
    "savedAt": "2026-01-29T14:04:25.098Z",
    "version": "1.0"
  },
  "data": {
    "epicId": "epic-sharing-ui",
    "storiesCount": 4,
    "architecture": "## Sharing UI Enhancement Architecture\n\n### Overview\nThis epic enhances the sharing feature UI following the existing Clean Architecture pattern with BLoC state management. All changes maintain consistency with the established codebase patterns.\n\n### Technology Stack\n- **State Management**: flutter_bloc with sealed classes\n- **Charts**: fl_chart (already used in dashboard)\n- **DI**: get_it service locator\n- **Routing**: go_router with BlocProvider wrapping\n- **UI Components**: Shared widgets (AppCard, AvatarWidget, EmptyState, LoadingIndicator)\n\n### Key Patterns to Follow\n\n1. **Widget Pattern**:\n   - Stateless widgets with data via constructor\n   - Use Theme.of(context).colorScheme for theming\n   - Use shared widgets from lib/shared/widgets/\n\n2. **BLoC Pattern**:\n   - Sealed classes for events/states (Dart 3)\n   - Equatable for state comparison\n   - Factory registration in injection_container.dart\n\n3. **UseCase Pattern**:\n   - Single responsibility\n   - Repository dependency via constructor\n   - LazySingleton registration\n\n4. **Chart Pattern** (from WeeklyChart):\n   - fl_chart LineChart with gradient fill\n   - Touch tooltips with date/value\n   - Proper empty state handling\n\n### File Structure\n```\nlib/features/sharing/\nâ”œâ”€â”€ data/\nâ”‚   â””â”€â”€ datasources/\nâ”‚       â””â”€â”€ sharing_remote_datasource.dart (MODIFY)\nâ”œâ”€â”€ domain/\nâ”‚   â””â”€â”€ usecases/\nâ”‚       â””â”€â”€ get_pending_requests_count_usecase.dart (CREATE)\nâ”œâ”€â”€ presentation/\nâ”‚   â”œâ”€â”€ bloc/\nâ”‚   â”‚   â”œâ”€â”€ sharing_bloc.dart (MODIFY)\nâ”‚   â”‚   â””â”€â”€ sharing_state.dart (MODIFY)\nâ”‚   â”œâ”€â”€ pages/\nâ”‚   â”‚   â”œâ”€â”€ friends_list_page.dart (MODIFY)\nâ”‚   â”‚   â”œâ”€â”€ friend_requests_page.dart (MODIFY)\nâ”‚   â”‚   â”œâ”€â”€ friend_activity_page.dart (MODIFY)\nâ”‚   â”‚   â””â”€â”€ add_friend_page.dart (MODIFY)\nâ”‚   â””â”€â”€ widgets/\nâ”‚       â”œâ”€â”€ friend_card.dart (MODIFY)\nâ”‚       â”œâ”€â”€ friend_request_card.dart (MODIFY)\nâ”‚       â”œâ”€â”€ friend_stats_card.dart (MODIFY)\nâ”‚       â”œâ”€â”€ friend_activity_chart.dart (CREATE)\nâ”‚       â””â”€â”€ pending_request_badge.dart (CREATE)\n```\n\n### Setup Commands\n```bash\nflutter pub get\n```\n\n### Verification Commands\n- **Analyze**: `flutter analyze lib/features/sharing/`\n- **Test**: `flutter test`\n- **Format**: `dart format lib/features/sharing/`\n\n### SOLID Principles Compliance\n- **SRP**: Each widget has single purpose (chart, badge, card)\n- **OCP**: New widgets extend existing patterns without modifying them\n- **LSP**: All widgets follow consistent StatelessWidget contract\n- **ISP**: Small, focused interfaces (SharedUser, FriendStats)\n- **DIP**: UseCase depends on SharingRepository interface",
    "stories": [
      {
        "id": "epic-sharing-ui-story-1",
        "title": "Create FriendActivityChart widget and enhance FriendActivityPage with visual activity data",
        "description": "Create a new chart widget following the WeeklyChart pattern from fl_chart to display friend step activity. Integrate into friend_activity_page and enhance friend_stats_card.\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nğŸ“ **FILES:**\n- Read: lib/features/dashboard/presentation/widgets/weekly_chart.dart (chart pattern), lib/features/sharing/domain/entities/friend_stats.dart, lib/shared/widgets/app_card.dart\n- Modify: lib/features/sharing/presentation/pages/friend_activity_page.dart, lib/features/sharing/presentation/widgets/friend_stats_card.dart\n- Create: lib/features/sharing/presentation/widgets/friend_activity_chart.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Follow WeeklyChart pattern from lib/features/dashboard/presentation/widgets/weekly_chart.dart\n- Use fl_chart LineChart with LineChartData for activity visualization\n- Use Theme.of(context).colorScheme for colors\n- Use AppCard from lib/shared/widgets/app_card.dart for container\n- Follow stateless widget pattern with data passed via constructor\n\nğŸ“¦ **REQUIRED STRUCTURE for FriendActivityChart:**\n- Constructor takes List<ActivityDataPoint> (create simple class with date/steps)\n- Build method returns LineChart with gradient fill\n- Include touch tooltips showing date and step count\n- Handle empty state with icon and message\n- Use _formatSteps helper for number formatting\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- DO NOT use BlocBuilder inside chart widget - data comes via props\n- DO NOT use hardcoded colors - use colorScheme\n- DO NOT use StatefulWidget unless necessary\n- NO placeholder text like \"Coming Soon\"\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n1. FriendActivityChart shows 7-day step trend line with gradient fill below\n2. X-axis shows day abbreviations (Mon, Tue, etc.)\n3. Y-axis shows step counts with K/M formatting\n4. Touch shows tooltip with date and exact step count\n5. Empty state shows \"No activity data\" with chart icon\n6. FriendStatsCard enhanced with clearer visual hierarchy\n7. friend_activity_page integrates chart below stats card\n\nğŸ§ª **VERIFICATION:**\n- Run: flutter analyze lib/features/sharing/\n- Run: flutter test (if tests exist)\n- Visual: Chart renders with mock data, tooltips work on touch",
        "epicId": "epic-sharing-ui",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/features/dashboard/presentation/widgets/weekly_chart.dart",
          "lib/features/sharing/domain/entities/friend_stats.dart",
          "lib/shared/widgets/app_card.dart",
          "lib/features/sharing/domain/entities/shared_user.dart"
        ],
        "filesToModify": [
          "lib/features/sharing/presentation/pages/friend_activity_page.dart",
          "lib/features/sharing/presentation/widgets/friend_stats_card.dart"
        ],
        "filesToCreate": [
          "lib/features/sharing/presentation/widgets/friend_activity_chart.dart"
        ],
        "acceptanceCriteria": [
          "Given a friend's activity data, When viewing friend_activity_page, Then a line chart displays 7-day step trend with gradient fill",
          "Given the chart is touched, When user taps a data point, Then tooltip shows date and exact step count",
          "Given no activity data, When chart renders, Then empty state shows 'No activity data' with icon",
          "Given the FriendStatsCard, When displayed, Then stats have clear visual hierarchy with improved spacing"
        ]
      },
      {
        "id": "epic-sharing-ui-story-2",
        "title": "Create PendingRequestBadge widget and enhance FriendRequestsPage with improved UI",
        "description": "Create a badge widget to show pending request count and enhance the friend_requests_page with better visual feedback and friend_request_card improvements.\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nğŸ“ **FILES:**\n- Read: lib/features/sharing/presentation/bloc/sharing_state.dart (for pendingRequests list), lib/shared/widgets/app_card.dart, lib/shared/widgets/avatar_widget.dart\n- Modify: lib/features/sharing/presentation/pages/friend_requests_page.dart, lib/features/sharing/presentation/widgets/friend_request_card.dart\n- Create: lib/features/sharing/presentation/widgets/pending_request_badge.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Use Theme.of(context).colorScheme for badge colors (errorContainer for urgent)\n- Use Container with BoxDecoration for badge circle\n- Access pending count from SharingLoaded state: state.pendingRequests.length\n- Follow existing widget patterns from friend_card.dart\n- Use AnimatedSwitcher for smooth count transitions\n\nğŸ“¦ **REQUIRED STRUCTURE for PendingRequestBadge:**\n```dart\nclass PendingRequestBadge extends StatelessWidget {\n  const PendingRequestBadge({required this.count, super.key});\n  final int count;\n  // Shows red circle badge with count (max 99+)\n  // Returns SizedBox.shrink() if count == 0\n}\n```\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- DO NOT hardcode badge color - use colorScheme.errorContainer\n- DO NOT show badge when count is 0\n- DO NOT use magic numbers - define constants\n- NO placeholder buttons without handlers\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n1. PendingRequestBadge shows count in red circle (colorScheme.errorContainer)\n2. Badge shows '99+' if count > 99\n3. Badge hidden when count is 0\n4. friend_requests_page AppBar shows badge next to title\n5. friend_request_card enhanced with:\n   - Better visual separation between user info and buttons\n   - Loading state on buttons during accept/reject\n   - Timestamp shows 'Just now', '5m ago', 'Yesterday' etc.\n6. Pull-to-refresh works with visual feedback\n\nğŸ§ª **VERIFICATION:**\n- Run: flutter analyze lib/features/sharing/\n- Visual: Badge shows correct count, buttons disable during loading",
        "epicId": "epic-sharing-ui",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/features/sharing/presentation/bloc/sharing_state.dart",
          "lib/shared/widgets/app_card.dart",
          "lib/shared/widgets/avatar_widget.dart",
          "lib/features/sharing/domain/entities/sharing_relationship.dart"
        ],
        "filesToModify": [
          "lib/features/sharing/presentation/pages/friend_requests_page.dart",
          "lib/features/sharing/presentation/widgets/friend_request_card.dart"
        ],
        "filesToCreate": [
          "lib/features/sharing/presentation/widgets/pending_request_badge.dart"
        ],
        "acceptanceCriteria": [
          "Given pending requests exist, When viewing friend_requests_page, Then badge shows count in AppBar",
          "Given count > 99, When badge renders, Then it shows '99+'",
          "Given count is 0, When badge renders, Then badge is not visible (SizedBox.shrink)",
          "Given accept button is pressed, When processing, Then button shows loading state and is disabled"
        ]
      },
      {
        "id": "epic-sharing-ui-story-3",
        "title": "Enhance FriendsListPage and FriendCard with improved data display and AddFriendPage UX",
        "description": "Enhance the friends list page with better friend cards showing real user data, and improve add_friend_page UX with better search feedback.\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nğŸ“ **FILES:**\n- Read: lib/features/sharing/domain/entities/shared_user.dart, lib/features/sharing/domain/entities/sharing_relationship.dart, lib/shared/widgets/empty_state.dart\n- Modify: lib/features/sharing/presentation/pages/friends_list_page.dart, lib/features/sharing/presentation/widgets/friend_card.dart, lib/features/sharing/presentation/pages/add_friend_page.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Use SharedUser entity for friend data (id, name, email, avatarUrl, todaySteps)\n- Use SharingRelationship entity for relationship metadata\n- Use AvatarWidget from lib/shared/widgets/avatar_widget.dart\n- Use AppCard for consistent card styling\n- Use RefreshIndicator for pull-to-refresh\n- Follow BlocBuilder pattern from existing pages\n\nğŸ“¦ **REQUIRED IMPROVEMENTS:**\n1. FriendCard now receives SharedUser directly (not constructed from relationship)\n2. _FriendCardItem in friends_list_page extracts user data properly\n3. Show pending requests badge in AppBar of friends_list_page\n4. AddFriendPage shows better empty search state\n5. Search debouncing already exists - enhance visual feedback\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- DO NOT construct SharedUser with placeholder data like 'Friend 1234'\n- DO NOT use direct model instantiation - use entities from state\n- DO NOT ignore null safety - use ?. and ?? operators\n- NO 'Coming Soon' or 'TODO' text\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n1. FriendCard displays: avatar, name, email, todaySteps badge (if available)\n2. friends_list_page shows pending request badge in AppBar actions\n3. Empty state shows clear message with 'Add Friend' action button\n4. add_friend_page search shows typing indicator during debounce\n5. add_friend_page 'No results' state shows search query used\n6. Swipe-to-dismiss on friend card shows remove confirmation\n\nğŸ§ª **VERIFICATION:**\n- Run: flutter analyze lib/features/sharing/\n- Visual: Friend cards show real-looking data, search feedback is clear",
        "epicId": "epic-sharing-ui",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/features/sharing/domain/entities/shared_user.dart",
          "lib/features/sharing/domain/entities/sharing_relationship.dart",
          "lib/shared/widgets/empty_state.dart",
          "lib/shared/widgets/avatar_widget.dart",
          "lib/features/sharing/presentation/bloc/sharing_state.dart"
        ],
        "filesToModify": [
          "lib/features/sharing/presentation/pages/friends_list_page.dart",
          "lib/features/sharing/presentation/widgets/friend_card.dart",
          "lib/features/sharing/presentation/pages/add_friend_page.dart"
        ],
        "filesToCreate": [],
        "acceptanceCriteria": [
          "Given a friend with step data, When FriendCard renders, Then it shows avatar, name, email, and step badge",
          "Given friends_list_page, When there are pending requests, Then badge shows in AppBar",
          "Given add_friend_page search, When typing, Then visual feedback shows search is processing",
          "Given add_friend_page with no results, When displayed, Then message includes the search query used"
        ]
      },
      {
        "id": "epic-sharing-ui-story-4",
        "title": "Create GetPendingRequestsCountUseCase and enhance SharingBloc with pendingCount tracking",
        "description": "Create a usecase for getting pending requests count and enhance the SharingBloc/State to track and expose this count. Update app_router and datasource as needed.\n\nğŸ”’ **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nğŸ“ **FILES:**\n- Read: lib/features/sharing/domain/usecases/get_relationships_usecase.dart (usecase pattern), lib/features/sharing/domain/repositories/sharing_repository.dart\n- Modify: lib/features/sharing/presentation/bloc/sharing_bloc.dart, lib/features/sharing/presentation/bloc/sharing_state.dart, lib/features/sharing/data/datasources/sharing_remote_datasource.dart, lib/core/router/app_router.dart\n- Create: lib/features/sharing/domain/usecases/get_pending_requests_count_usecase.dart\n\nğŸ”§ **PATTERNS TO USE:**\n- Follow GetRelationshipsUseCase pattern for new usecase\n- UseCase takes SharingRepository in constructor\n- Register usecase in injection_container.dart (add to sharing section)\n- SharingLoaded state already has pendingRequests list - add getter for count\n- Use sealed class pattern for any new state variants\n\nğŸ“¦ **REQUIRED STRUCTURE for GetPendingRequestsCountUseCase:**\n```dart\nclass GetPendingRequestsCountUseCase {\n  GetPendingRequestsCountUseCase({required SharingRepository repository})\n      : _repository = repository;\n  final SharingRepository _repository;\n  \n  Future<int> call() async {\n    final relationships = await _repository.getRelationships();\n    // Filter for pending requests where current user is recipient\n    return relationships.where((r) => r.isPending).length;\n  }\n}\n```\n\nâš ï¸ **ANTI-PATTERNS TO AVOID:**\n- DO NOT add new API endpoint if data is already available from getRelationships\n- DO NOT modify existing state classes - extend them if needed\n- DO NOT forget to register usecase in injection_container.dart\n- DO NOT break existing BLoC functionality\n\nğŸ¯ **FUNCTIONAL REQUIREMENTS:**\n1. GetPendingRequestsCountUseCase returns count of pending requests\n2. SharingLoaded state has `int get pendingCount => pendingRequests.length`\n3. SharingBloc emits state with accurate pending count\n4. app_router ensures SharingBloc is properly provided to pages needing badge\n5. sharing_remote_datasource has any new helper methods if needed\n6. Register usecase in lib/core/di/injection_container.dart\n\nğŸ§ª **VERIFICATION:**\n- Run: flutter analyze lib/features/sharing/\n- Run: flutter analyze lib/core/\n- Verify: Usecase is registered in injection_container.dart",
        "epicId": "epic-sharing-ui",
        "priority": 2,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/features/sharing/domain/usecases/get_relationships_usecase.dart",
          "lib/features/sharing/domain/repositories/sharing_repository.dart",
          "lib/core/di/injection_container.dart"
        ],
        "filesToModify": [
          "lib/features/sharing/presentation/bloc/sharing_bloc.dart",
          "lib/features/sharing/presentation/bloc/sharing_state.dart",
          "lib/features/sharing/data/datasources/sharing_remote_datasource.dart",
          "lib/core/router/app_router.dart",
          "lib/core/di/injection_container.dart"
        ],
        "filesToCreate": [
          "lib/features/sharing/domain/usecases/get_pending_requests_count_usecase.dart"
        ],
        "acceptanceCriteria": [
          "Given GetPendingRequestsCountUseCase, When called, Then returns count of pending requests",
          "Given SharingLoaded state, When accessed, Then pendingCount getter returns correct count",
          "Given injection_container.dart, When app starts, Then GetPendingRequestsCountUseCase is registered",
          "Given app_router.dart, When navigating to friends routes, Then SharingBloc is properly provided"
        ]
      }
    ]
  }
}