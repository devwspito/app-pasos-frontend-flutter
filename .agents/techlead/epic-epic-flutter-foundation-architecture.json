{
  "_metadata": {
    "agentType": "techlead",
    "taskId": "10f320470f7092e9ce178ef3",
    "timestamp": "2026-01-23T22:05:17.257Z",
    "phase": "techlead",
    "epicId": "epic-flutter-foundation",
    "savedAt": "2026-01-23T22:05:17.258Z",
    "version": "1.0"
  },
  "data": {
    "epicId": "epic-flutter-foundation",
    "storiesCount": 5,
    "architecture": "## Flutter Foundation Architecture\n\n### Project Structure (Feature-First Clean Architecture)\n```\nlib/\n‚îú‚îÄ‚îÄ main.dart                    # App entry point with ProviderScope\n‚îú‚îÄ‚îÄ core/\n‚îÇ   ‚îú‚îÄ‚îÄ config/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ environment.dart     # Environment configuration from .env\n‚îÇ   ‚îú‚îÄ‚îÄ constants/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_constants.dart   # API endpoint paths and timeouts\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_constants.dart   # App-wide constants\n‚îÇ   ‚îú‚îÄ‚îÄ network/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dio_client.dart      # HTTP client singleton\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_interceptor.dart # Auth token injection & refresh\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_exceptions.dart  # Typed exception hierarchy\n‚îÇ   ‚îú‚îÄ‚îÄ models/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_response.dart    # Generic API response wrapper\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pagination.dart      # Pagination models and params\n‚îÇ   ‚îú‚îÄ‚îÄ providers/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers.dart       # Core Riverpod providers\n‚îÇ   ‚îú‚îÄ‚îÄ utils/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.dart          # Logging utility using dart:developer\n‚îÇ   ‚îî‚îÄ‚îÄ extensions/\n‚îÇ       ‚îú‚îÄ‚îÄ context_extensions.dart  # BuildContext shortcuts\n‚îÇ       ‚îú‚îÄ‚îÄ string_extensions.dart   # String validation & transformation\n‚îÇ       ‚îî‚îÄ‚îÄ date_extensions.dart     # DateTime formatting\n‚îî‚îÄ‚îÄ features/                    # (Created in subsequent epics)\n    ‚îî‚îÄ‚îÄ [feature_name]/\n        ‚îú‚îÄ‚îÄ data/\n        ‚îú‚îÄ‚îÄ domain/\n        ‚îî‚îÄ‚îÄ presentation/\n```\n\n### Technology Stack\n- **State Management**: Riverpod (flutter_riverpod: ^2.4.0)\n- **HTTP Client**: Dio (dio: ^5.3.0) with interceptors\n- **Routing**: go_router: ^12.0.0 (configured in UI Foundation epic)\n- **Secure Storage**: flutter_secure_storage: ^9.0.0\n- **Environment**: flutter_dotenv: ^5.1.0\n- **Code Generation**: json_serializable, riverpod_generator, build_runner\n\n### Key Patterns\n1. **Singleton DioClient via Riverpod Provider** - Global HTTP client with auth interceptor\n2. **QueuedInterceptorsWrapper** - Handles 401 with automatic token refresh\n3. **Typed API Exceptions** - NetworkException, UnauthorizedException, ValidationException, etc.\n4. **Generic ApiResponse<T>** - Consistent API response handling\n5. **Environment Singleton** - Loads .env config before app starts\n\n### Dependency Flow\n```\nmain.dart\n    ‚îî‚îÄ‚îÄ Environment.initialize()\n    ‚îî‚îÄ‚îÄ ProviderScope\n        ‚îî‚îÄ‚îÄ providers.dart\n            ‚îú‚îÄ‚îÄ secureStorageProvider\n            ‚îî‚îÄ‚îÄ dioClientProvider\n                ‚îî‚îÄ‚îÄ DioClient\n                    ‚îî‚îÄ‚îÄ ApiInterceptor (uses secureStorage)\n```\n\n### SOLID Compliance\n- **SRP**: Each file has single responsibility (DioClient = HTTP, ApiInterceptor = Auth)\n- **OCP**: ApiException hierarchy allows extension without modification\n- **LSP**: All exceptions extend ApiException and can be caught as base type\n- **ISP**: Extensions are small and focused (context, string, date)\n- **DIP**: DioClient depends on abstraction (FlutterSecureStorage interface)",
    "stories": [
      {
        "id": "epic-flutter-foundation-story-1",
        "title": "Create pubspec.yaml with core dependencies and analysis_options.yaml for linting",
        "description": "**What to implement:**\nCreate the Flutter project configuration files that define all dependencies and linting rules for the project.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [.env.example](/.env.example) (for environment context)\n- Modify: [.gitignore](/.gitignore) (add Flutter-specific entries)\n- Create: pubspec.yaml, analysis_options.yaml\n\nüîß **PATTERNS TO USE:**\n- Use `flutter_riverpod: ^2.4.0` for state management (NOT provider package)\n- Use `dio: ^5.3.0` for HTTP client (NOT http package)\n- Use `flutter_dotenv: ^5.1.0` for environment configuration\n- Use `flutter_secure_storage: ^9.0.0` for secure token storage\n- Use `go_router: ^12.0.0` for routing\n- Use recommended Flutter lints with `flutter_lints: ^3.0.0`\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Using `provider` package instead of `riverpod` ‚Üê WRONG\n- Using `http` package instead of `dio` ‚Üê WRONG\n- Missing `assets: - .env` in pubspec.yaml ‚Üê App won't load env\n- Forgetting `uses-material-design: true` ‚Üê Icons won't work\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n\n**pubspec.yaml must include:**\n```yaml\nname: app_pasos\ndescription: Step tracking social app\nversion: 1.0.0+1\n\nenvironment:\n  sdk: '>=3.0.0 <4.0.0'\n  flutter: '>=3.10.0'\n\ndependencies:\n  flutter:\n    sdk: flutter\n  flutter_riverpod: ^2.4.0\n  riverpod_annotation: ^2.3.0\n  dio: ^5.3.0\n  flutter_dotenv: ^5.1.0\n  flutter_secure_storage: ^9.0.0\n  go_router: ^12.0.0\n  intl: ^0.18.0\n  equatable: ^2.0.5\n  json_annotation: ^4.8.1\n  logger: ^2.0.2\n\ndev_dependencies:\n  flutter_test:\n    sdk: flutter\n  flutter_lints: ^3.0.0\n  build_runner: ^2.4.0\n  json_serializable: ^6.7.0\n  riverpod_generator: ^2.3.0\n\nflutter:\n  uses-material-design: true\n  assets:\n    - .env\n```\n\n**analysis_options.yaml must include:**\n- include: package:flutter_lints/flutter.yaml\n- Strong mode enabled\n- Avoid print (use logger)\n- Require trailing commas\n\n**.gitignore additions for Flutter:**\n```\n# Flutter/Dart\n.dart_tool/\n.flutter-plugins\n.flutter-plugins-dependencies\n.packages\n.pub-cache/\n.pub/\nbuild/\nflutter_*.png\n*.iml\n```\n\nüß™ **VERIFICATION:**\n1. `flutter pub get` - Dependencies install successfully\n2. `flutter analyze` - No linting errors\n3. Check pubspec.yaml has all required dependencies",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          ".env.example"
        ],
        "filesToModify": [
          ".gitignore"
        ],
        "filesToCreate": [
          "pubspec.yaml",
          "analysis_options.yaml"
        ],
        "acceptanceCriteria": [
          "Given pubspec.yaml exists, When running flutter pub get, Then all dependencies install without errors",
          "Given analysis_options.yaml exists, When running flutter analyze, Then no linting errors are reported",
          "Given .gitignore is updated, When checking git status, Then Flutter build artifacts are ignored"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-2",
        "title": "Create lib/core/constants/ and lib/core/config/environment.dart for app configuration",
        "description": "**What to implement:**\nCreate constant values and environment configuration that the entire app will use for API URLs, app settings, and environment detection.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [.env.example](/.env.example) (for environment variables)\n- Modify: none\n- Create: lib/core/constants/api_constants.dart, lib/core/constants/app_constants.dart, lib/core/config/environment.dart\n\nüîß **PATTERNS TO USE:**\n- Use `flutter_dotenv` to load environment variables: `dotenv.env['API_BASE_URL']`\n- Use abstract final classes for constants (Dart 3 pattern)\n- Use `Environment` singleton pattern with factory constructor\n- Read API_BASE_URL from .env: `http://localhost:3001/api`\n- Read WS_URL from .env: `ws://localhost:3001`\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Hardcoding API URLs directly ‚Üê Use environment variables\n- Using `const` class with instance methods ‚Üê Use `abstract final class`\n- Not handling missing env variables ‚Üê Provide fallback defaults\n- Creating mutable constants ‚Üê All values must be final/const\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n\n**lib/core/constants/api_constants.dart:**\n```dart\nabstract final class ApiConstants {\n  static const String authLogin = '/auth/login';\n  static const String authRegister = '/auth/register';\n  static const String authRefresh = '/auth/refresh';\n  static const String authLogout = '/auth/logout';\n  static const String authForgotPassword = '/auth/forgot-password';\n  \n  static const String steps = '/steps';\n  static const String stepsToday = '/steps/today';\n  static const String stepsStats = '/steps/stats';\n  \n  static const String users = '/users';\n  static const String usersMe = '/users/me';\n  static const String usersSearch = '/users/search';\n  \n  static const String sharing = '/sharing';\n  static const String sharingRequests = '/sharing/requests';\n  static const String sharingFriends = '/sharing/friends';\n  \n  static const String goals = '/goals';\n  static const String goalsActive = '/goals/active';\n  \n  static const Duration connectTimeout = Duration(seconds: 30);\n  static const Duration receiveTimeout = Duration(seconds: 30);\n}\n```\n\n**lib/core/constants/app_constants.dart:**\n```dart\nabstract final class AppConstants {\n  static const String appName = 'Pasos';\n  static const String appVersion = '1.0.0';\n  \n  static const int defaultStepGoal = 10000;\n  static const int maxFriends = 100;\n  static const int searchDebounceMs = 300;\n  \n  static const String tokenKey = 'auth_token';\n  static const String refreshTokenKey = 'refresh_token';\n  static const String userKey = 'user_data';\n}\n```\n\n**lib/core/config/environment.dart:**\n```dart\nimport 'package:flutter_dotenv/flutter_dotenv.dart';\n\nenum EnvironmentType { development, staging, production }\n\nclass Environment {\n  static Environment? _instance;\n  \n  final String apiBaseUrl;\n  final String wsUrl;\n  final EnvironmentType type;\n  final bool enableAnalytics;\n  final bool enableCrashlytics;\n  final String appScheme;\n  final String appHost;\n  \n  Environment._internal({\n    required this.apiBaseUrl,\n    required this.wsUrl,\n    required this.type,\n    required this.enableAnalytics,\n    required this.enableCrashlytics,\n    required this.appScheme,\n    required this.appHost,\n  });\n  \n  static Environment get instance {\n    if (_instance == null) {\n      throw StateError('Environment not initialized. Call Environment.initialize() first.');\n    }\n    return _instance!;\n  }\n  \n  static Future<void> initialize() async {\n    await dotenv.load(fileName: '.env');\n    \n    final envString = dotenv.env['ENVIRONMENT'] ?? 'development';\n    final type = EnvironmentType.values.firstWhere(\n      (e) => e.name == envString,\n      orElse: () => EnvironmentType.development,\n    );\n    \n    _instance = Environment._internal(\n      apiBaseUrl: dotenv.env['API_BASE_URL'] ?? 'http://localhost:3001/api',\n      wsUrl: dotenv.env['WS_URL'] ?? 'ws://localhost:3001',\n      type: type,\n      enableAnalytics: dotenv.env['ENABLE_ANALYTICS'] == 'true',\n      enableCrashlytics: dotenv.env['ENABLE_CRASHLYTICS'] == 'true',\n      appScheme: dotenv.env['APP_SCHEME'] ?? 'apppasos',\n      appHost: dotenv.env['APP_HOST'] ?? 'app.pasos.com',\n    );\n  }\n  \n  bool get isDevelopment => type == EnvironmentType.development;\n  bool get isProduction => type == EnvironmentType.production;\n}\n```\n\nüß™ **VERIFICATION:**\n1. `flutter analyze lib/core/constants/` - No errors\n2. `flutter analyze lib/core/config/` - No errors\n3. All API endpoints from backend are covered in ApiConstants",
        "epicId": "epic-flutter-foundation",
        "priority": 2,
        "estimatedComplexity": "simple",
        "dependencies": [
          "epic-flutter-foundation-story-1"
        ],
        "status": "pending",
        "filesToRead": [
          ".env.example"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/constants/api_constants.dart",
          "lib/core/constants/app_constants.dart",
          "lib/core/config/environment.dart"
        ],
        "acceptanceCriteria": [
          "Given api_constants.dart exists, When imported, Then all backend API endpoints are accessible as static constants",
          "Given app_constants.dart exists, When imported, Then app configuration values are accessible",
          "Given environment.dart exists, When Environment.initialize() is called, Then environment variables are loaded from .env file"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-3",
        "title": "Create lib/core/network/ with Dio client, interceptors, and API exceptions",
        "description": "**What to implement:**\nCreate the HTTP client layer using Dio with interceptors for authentication token injection, request/response logging, and error handling.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/core/constants/api_constants.dart, lib/core/config/environment.dart\n- Modify: none\n- Create: lib/core/network/dio_client.dart, lib/core/network/api_interceptor.dart, lib/core/network/api_exceptions.dart\n\nüîß **PATTERNS TO USE:**\n- Use `Dio` with `BaseOptions` configured from Environment\n- Use `QueuedInterceptorsWrapper` for token refresh handling\n- Use custom exceptions extending base `ApiException`\n- Use `Environment.instance.apiBaseUrl` for base URL\n- Use `ApiConstants.connectTimeout` and `ApiConstants.receiveTimeout` for timeouts\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Creating new Dio instance per request ‚Üê Use singleton DioClient\n- Hardcoding base URL in Dio options ‚Üê Use Environment.instance.apiBaseUrl\n- Throwing generic Exception ‚Üê Use typed ApiException subclasses\n- Not handling 401 for token refresh ‚Üê Must queue requests and retry after refresh\n- Logging sensitive data (tokens) ‚Üê Redact Authorization header in logs\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n\n**lib/core/network/api_exceptions.dart:**\n```dart\nabstract class ApiException implements Exception {\n  final String message;\n  final int? statusCode;\n  final dynamic data;\n  \n  const ApiException(this.message, {this.statusCode, this.data});\n  \n  @override\n  String toString() => 'ApiException: $message (status: $statusCode)';\n}\n\nclass NetworkException extends ApiException {\n  const NetworkException([String message = 'Network connection failed'])\n      : super(message);\n}\n\nclass UnauthorizedException extends ApiException {\n  const UnauthorizedException([String message = 'Unauthorized'])\n      : super(message, statusCode: 401);\n}\n\nclass BadRequestException extends ApiException {\n  const BadRequestException(String message, {dynamic data})\n      : super(message, statusCode: 400, data: data);\n}\n\nclass NotFoundException extends ApiException {\n  const NotFoundException([String message = 'Resource not found'])\n      : super(message, statusCode: 404);\n}\n\nclass ServerException extends ApiException {\n  const ServerException([String message = 'Internal server error'])\n      : super(message, statusCode: 500);\n}\n\nclass ValidationException extends ApiException {\n  final Map<String, List<String>>? errors;\n  \n  const ValidationException(String message, {this.errors})\n      : super(message, statusCode: 422);\n}\n```\n\n**lib/core/network/api_interceptor.dart:**\n```dart\nimport 'package:dio/dio.dart';\nimport 'package:flutter_secure_storage/flutter_secure_storage.dart';\nimport '../constants/app_constants.dart';\nimport 'api_exceptions.dart';\n\nclass ApiInterceptor extends QueuedInterceptorsWrapper {\n  final FlutterSecureStorage _storage;\n  final Dio _dio;\n  \n  ApiInterceptor(this._dio, this._storage);\n  \n  @override\n  void onRequest(RequestOptions options, RequestInterceptorHandler handler) async {\n    final token = await _storage.read(key: AppConstants.tokenKey);\n    if (token != null) {\n      options.headers['Authorization'] = 'Bearer $token';\n    }\n    options.headers['Content-Type'] = 'application/json';\n    options.headers['Accept'] = 'application/json';\n    handler.next(options);\n  }\n  \n  @override\n  void onError(DioException err, ErrorInterceptorHandler handler) async {\n    if (err.response?.statusCode == 401) {\n      // Attempt token refresh\n      final refreshed = await _refreshToken();\n      if (refreshed) {\n        // Retry original request\n        try {\n          final response = await _dio.fetch(err.requestOptions);\n          return handler.resolve(response);\n        } catch (e) {\n          return handler.next(err);\n        }\n      }\n    }\n    handler.next(err);\n  }\n  \n  Future<bool> _refreshToken() async {\n    try {\n      final refreshToken = await _storage.read(key: AppConstants.refreshTokenKey);\n      if (refreshToken == null) return false;\n      \n      final response = await _dio.post(\n        '/auth/refresh',\n        data: {'refreshToken': refreshToken},\n        options: Options(headers: {'Authorization': ''}),\n      );\n      \n      if (response.statusCode == 200) {\n        final newToken = response.data['accessToken'];\n        final newRefresh = response.data['refreshToken'];\n        await _storage.write(key: AppConstants.tokenKey, value: newToken);\n        await _storage.write(key: AppConstants.refreshTokenKey, value: newRefresh);\n        return true;\n      }\n    } catch (_) {}\n    \n    // Clear tokens on refresh failure\n    await _storage.deleteAll();\n    return false;\n  }\n}\n```\n\n**lib/core/network/dio_client.dart:**\n```dart\nimport 'package:dio/dio.dart';\nimport 'package:flutter_secure_storage/flutter_secure_storage.dart';\nimport '../config/environment.dart';\nimport '../constants/api_constants.dart';\nimport 'api_exceptions.dart';\nimport 'api_interceptor.dart';\n\nclass DioClient {\n  late final Dio _dio;\n  final FlutterSecureStorage _storage;\n  \n  DioClient({FlutterSecureStorage? storage})\n      : _storage = storage ?? const FlutterSecureStorage() {\n    _dio = Dio(\n      BaseOptions(\n        baseUrl: Environment.instance.apiBaseUrl,\n        connectTimeout: ApiConstants.connectTimeout,\n        receiveTimeout: ApiConstants.receiveTimeout,\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n      ),\n    );\n    \n    _dio.interceptors.add(ApiInterceptor(_dio, _storage));\n    \n    if (Environment.instance.isDevelopment) {\n      _dio.interceptors.add(LogInterceptor(\n        requestBody: true,\n        responseBody: true,\n        logPrint: (obj) => print('[DIO] $obj'),\n      ));\n    }\n  }\n  \n  Future<T> get<T>(\n    String path, {\n    Map<String, dynamic>? queryParameters,\n    Options? options,\n  }) async {\n    try {\n      final response = await _dio.get<T>(\n        path,\n        queryParameters: queryParameters,\n        options: options,\n      );\n      return response.data as T;\n    } on DioException catch (e) {\n      throw _handleError(e);\n    }\n  }\n  \n  Future<T> post<T>(\n    String path, {\n    dynamic data,\n    Map<String, dynamic>? queryParameters,\n    Options? options,\n  }) async {\n    try {\n      final response = await _dio.post<T>(\n        path,\n        data: data,\n        queryParameters: queryParameters,\n        options: options,\n      );\n      return response.data as T;\n    } on DioException catch (e) {\n      throw _handleError(e);\n    }\n  }\n  \n  Future<T> put<T>(\n    String path, {\n    dynamic data,\n    Options? options,\n  }) async {\n    try {\n      final response = await _dio.put<T>(path, data: data, options: options);\n      return response.data as T;\n    } on DioException catch (e) {\n      throw _handleError(e);\n    }\n  }\n  \n  Future<T> delete<T>(String path, {Options? options}) async {\n    try {\n      final response = await _dio.delete<T>(path, options: options);\n      return response.data as T;\n    } on DioException catch (e) {\n      throw _handleError(e);\n    }\n  }\n  \n  ApiException _handleError(DioException e) {\n    switch (e.type) {\n      case DioExceptionType.connectionTimeout:\n      case DioExceptionType.sendTimeout:\n      case DioExceptionType.receiveTimeout:\n      case DioExceptionType.connectionError:\n        return const NetworkException();\n      case DioExceptionType.badResponse:\n        return _handleResponseError(e.response);\n      default:\n        return NetworkException(e.message ?? 'Unknown error');\n    }\n  }\n  \n  ApiException _handleResponseError(Response? response) {\n    final statusCode = response?.statusCode;\n    final data = response?.data;\n    final message = data?['message'] ?? data?['error'] ?? 'Unknown error';\n    \n    switch (statusCode) {\n      case 400:\n        return BadRequestException(message, data: data);\n      case 401:\n        return UnauthorizedException(message);\n      case 404:\n        return NotFoundException(message);\n      case 422:\n        return ValidationException(message, errors: data?['errors']);\n      case 500:\n      default:\n        return ServerException(message);\n    }\n  }\n}\n```\n\nüß™ **VERIFICATION:**\n1. `flutter analyze lib/core/network/` - No errors\n2. DioClient has get, post, put, delete methods\n3. ApiInterceptor handles 401 with token refresh\n4. All exception types properly extend ApiException",
        "epicId": "epic-flutter-foundation",
        "priority": 3,
        "estimatedComplexity": "moderate",
        "dependencies": [
          "epic-flutter-foundation-story-1",
          "epic-flutter-foundation-story-2"
        ],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/api_constants.dart",
          "lib/core/config/environment.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/network/dio_client.dart",
          "lib/core/network/api_interceptor.dart",
          "lib/core/network/api_exceptions.dart"
        ],
        "acceptanceCriteria": [
          "Given DioClient exists, When making HTTP requests, Then proper headers and base URL are used",
          "Given ApiInterceptor is configured, When a 401 response is received, Then token refresh is attempted automatically",
          "Given api_exceptions.dart exists, When API errors occur, Then typed exceptions are thrown (NetworkException, UnauthorizedException, etc.)"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-4",
        "title": "Create lib/core/utils/logger.dart and lib/core/extensions/ with Dart extensions",
        "description": "**What to implement:**\nCreate utility classes and Dart extensions to provide helper methods for logging, context access, string manipulation, and date formatting.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: none\n- Modify: none\n- Create: lib/core/utils/logger.dart, lib/core/extensions/context_extensions.dart, lib/core/extensions/string_extensions.dart, lib/core/extensions/date_extensions.dart\n\nüîß **PATTERNS TO USE:**\n- Use `dart:developer` for logging (NOT print statements)\n- Use `extension` keyword for Dart extensions\n- Use `on BuildContext` for context extensions\n- Use `on String` for string extensions\n- Use `on DateTime` for date extensions\n- Use `intl` package for date formatting\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Using print() for logging ‚Üê Use dart:developer log()\n- Creating utility classes with instance methods ‚Üê Use extensions or static methods\n- Hardcoding date format strings ‚Üê Use intl DateFormat\n- Not handling null safety in extensions ‚Üê Check for null/empty\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n\n**lib/core/utils/logger.dart:**\n```dart\nimport 'dart:developer' as developer;\nimport '../config/environment.dart';\n\nenum LogLevel { debug, info, warning, error }\n\nclass AppLogger {\n  static void debug(String message, {String? tag, Object? error, StackTrace? stackTrace}) {\n    _log(LogLevel.debug, message, tag: tag, error: error, stackTrace: stackTrace);\n  }\n  \n  static void info(String message, {String? tag}) {\n    _log(LogLevel.info, message, tag: tag);\n  }\n  \n  static void warning(String message, {String? tag, Object? error}) {\n    _log(LogLevel.warning, message, tag: tag, error: error);\n  }\n  \n  static void error(String message, {String? tag, Object? error, StackTrace? stackTrace}) {\n    _log(LogLevel.error, message, tag: tag, error: error, stackTrace: stackTrace);\n  }\n  \n  static void _log(\n    LogLevel level,\n    String message, {\n    String? tag,\n    Object? error,\n    StackTrace? stackTrace,\n  }) {\n    // Only log in development\n    if (!Environment.instance.isDevelopment && level == LogLevel.debug) {\n      return;\n    }\n    \n    final emoji = switch (level) {\n      LogLevel.debug => 'üîç',\n      LogLevel.info => '‚ÑπÔ∏è',\n      LogLevel.warning => '‚ö†Ô∏è',\n      LogLevel.error => '‚ùå',\n    };\n    \n    final logMessage = '$emoji [${tag ?? 'APP'}] $message';\n    \n    developer.log(\n      logMessage,\n      name: tag ?? 'AppLogger',\n      error: error,\n      stackTrace: stackTrace,\n      level: switch (level) {\n        LogLevel.debug => 500,\n        LogLevel.info => 800,\n        LogLevel.warning => 900,\n        LogLevel.error => 1000,\n      },\n    );\n  }\n}\n```\n\n**lib/core/extensions/context_extensions.dart:**\n```dart\nimport 'package:flutter/material.dart';\n\nextension BuildContextExtensions on BuildContext {\n  // Theme shortcuts\n  ThemeData get theme => Theme.of(this);\n  TextTheme get textTheme => Theme.of(this).textTheme;\n  ColorScheme get colorScheme => Theme.of(this).colorScheme;\n  \n  // MediaQuery shortcuts\n  MediaQueryData get mediaQuery => MediaQuery.of(this);\n  Size get screenSize => MediaQuery.sizeOf(this);\n  double get screenWidth => MediaQuery.sizeOf(this).width;\n  double get screenHeight => MediaQuery.sizeOf(this).height;\n  EdgeInsets get padding => MediaQuery.paddingOf(this);\n  EdgeInsets get viewInsets => MediaQuery.viewInsetsOf(this);\n  bool get isKeyboardVisible => MediaQuery.viewInsetsOf(this).bottom > 0;\n  \n  // Platform brightness\n  bool get isDarkMode => Theme.of(this).brightness == Brightness.dark;\n  \n  // Navigation shortcuts\n  void pop<T>([T? result]) => Navigator.of(this).pop(result);\n  Future<T?> push<T>(Widget page) => Navigator.of(this).push<T>(\n    MaterialPageRoute(builder: (_) => page),\n  );\n  \n  // Snackbar shortcut\n  void showSnackBar(String message, {bool isError = false}) {\n    ScaffoldMessenger.of(this).showSnackBar(\n      SnackBar(\n        content: Text(message),\n        backgroundColor: isError ? colorScheme.error : null,\n        behavior: SnackBarBehavior.floating,\n      ),\n    );\n  }\n  \n  // Focus shortcut\n  void unfocus() => FocusScope.of(this).unfocus();\n}\n```\n\n**lib/core/extensions/string_extensions.dart:**\n```dart\nextension StringExtensions on String {\n  // Validation\n  bool get isValidEmail {\n    final emailRegex = RegExp(r'^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$');\n    return emailRegex.hasMatch(this);\n  }\n  \n  bool get isValidPassword => length >= 8;\n  \n  bool get isValidUsername {\n    final usernameRegex = RegExp(r'^[a-zA-Z0-9_]{3,20}$');\n    return usernameRegex.hasMatch(this);\n  }\n  \n  // Transformations\n  String get capitalize {\n    if (isEmpty) return this;\n    return '${this[0].toUpperCase()}${substring(1)}';\n  }\n  \n  String get capitalizeWords {\n    if (isEmpty) return this;\n    return split(' ').map((word) => word.capitalize).join(' ');\n  }\n  \n  String truncate(int maxLength, {String ellipsis = '...'}) {\n    if (length <= maxLength) return this;\n    return '${substring(0, maxLength - ellipsis.length)}$ellipsis';\n  }\n  \n  // Null-safe\n  String get orEmpty => this;\n  bool get isBlank => trim().isEmpty;\n  bool get isNotBlank => trim().isNotEmpty;\n}\n\nextension NullableStringExtensions on String? {\n  bool get isNullOrEmpty => this == null || this!.isEmpty;\n  bool get isNullOrBlank => this == null || this!.trim().isEmpty;\n  String get orEmpty => this ?? '';\n}\n```\n\n**lib/core/extensions/date_extensions.dart:**\n```dart\nimport 'package:intl/intl.dart';\n\nextension DateTimeExtensions on DateTime {\n  // Formatting\n  String get formatted => DateFormat('MMM d, yyyy').format(this);\n  String get formattedWithTime => DateFormat('MMM d, yyyy HH:mm').format(this);\n  String get timeOnly => DateFormat('HH:mm').format(this);\n  String get dateOnly => DateFormat('yyyy-MM-dd').format(this);\n  String get dayMonth => DateFormat('d MMM').format(this);\n  String get fullDate => DateFormat('EEEE, MMMM d, yyyy').format(this);\n  \n  // Relative time\n  String get timeAgo {\n    final now = DateTime.now();\n    final difference = now.difference(this);\n    \n    if (difference.inDays > 365) {\n      return '${(difference.inDays / 365).floor()} years ago';\n    } else if (difference.inDays > 30) {\n      return '${(difference.inDays / 30).floor()} months ago';\n    } else if (difference.inDays > 0) {\n      return '${difference.inDays} days ago';\n    } else if (difference.inHours > 0) {\n      return '${difference.inHours} hours ago';\n    } else if (difference.inMinutes > 0) {\n      return '${difference.inMinutes} minutes ago';\n    } else {\n      return 'Just now';\n    }\n  }\n  \n  // Comparisons\n  bool get isToday {\n    final now = DateTime.now();\n    return year == now.year && month == now.month && day == now.day;\n  }\n  \n  bool get isYesterday {\n    final yesterday = DateTime.now().subtract(const Duration(days: 1));\n    return year == yesterday.year && month == yesterday.month && day == yesterday.day;\n  }\n  \n  bool get isThisWeek {\n    final now = DateTime.now();\n    final startOfWeek = now.subtract(Duration(days: now.weekday - 1));\n    return isAfter(startOfWeek) || isAtSameMomentAs(startOfWeek);\n  }\n  \n  // Utilities\n  DateTime get startOfDay => DateTime(year, month, day);\n  DateTime get endOfDay => DateTime(year, month, day, 23, 59, 59);\n  DateTime get startOfWeek => subtract(Duration(days: weekday - 1)).startOfDay;\n  DateTime get endOfWeek => startOfWeek.add(const Duration(days: 6)).endOfDay;\n}\n```\n\nüß™ **VERIFICATION:**\n1. `flutter analyze lib/core/utils/` - No errors\n2. `flutter analyze lib/core/extensions/` - No errors\n3. All extensions provide useful shortcuts without side effects",
        "epicId": "epic-flutter-foundation",
        "priority": 4,
        "estimatedComplexity": "simple",
        "dependencies": [
          "epic-flutter-foundation-story-1"
        ],
        "status": "pending",
        "filesToRead": [],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/utils/logger.dart",
          "lib/core/extensions/context_extensions.dart",
          "lib/core/extensions/string_extensions.dart",
          "lib/core/extensions/date_extensions.dart"
        ],
        "acceptanceCriteria": [
          "Given logger.dart exists, When calling AppLogger.debug/info/warning/error, Then messages are logged via dart:developer",
          "Given context_extensions.dart exists, When using context.theme or context.screenWidth, Then values are returned correctly",
          "Given string_extensions.dart exists, When validating emails with isValidEmail, Then proper validation is performed",
          "Given date_extensions.dart exists, When formatting dates with .formatted, Then dates are formatted using intl"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-5",
        "title": "Create lib/core/models/, lib/core/providers/providers.dart, and lib/main.dart app entry point",
        "description": "**What to implement:**\nCreate the core models for API responses and pagination, configure Riverpod providers, and create the main app entry point that initializes the environment and launches the app.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/core/config/environment.dart, lib/core/network/dio_client.dart\n- Modify: none\n- Create: lib/core/models/api_response.dart, lib/core/models/pagination.dart, lib/core/providers/providers.dart, lib/main.dart\n\nüîß **PATTERNS TO USE:**\n- Use `@freezed` or manual `copyWith` for immutable models\n- Use `@JsonSerializable` for JSON serialization\n- Use `Provider` from Riverpod for DioClient singleton\n- Use `ProviderScope` as root widget in main.dart\n- Use `Environment.initialize()` before runApp()\n- Use generic `ApiResponse<T>` for typed API responses\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Calling runApp() before Environment.initialize() ‚Üê App will crash\n- Creating DioClient without Provider ‚Üê Can't be accessed globally\n- Using mutable models ‚Üê Use immutable with copyWith\n- Not wrapping app with ProviderScope ‚Üê Riverpod won't work\n- Forgetting WidgetsFlutterBinding.ensureInitialized() ‚Üê Plugins won't work\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n\n**lib/core/models/api_response.dart:**\n```dart\nimport 'package:json_annotation/json_annotation.dart';\n\npart 'api_response.g.dart';\n\n@JsonSerializable(genericArgumentFactories: true)\nclass ApiResponse<T> {\n  final bool success;\n  final String? message;\n  final T? data;\n  final ApiError? error;\n  \n  const ApiResponse({\n    required this.success,\n    this.message,\n    this.data,\n    this.error,\n  });\n  \n  factory ApiResponse.fromJson(\n    Map<String, dynamic> json,\n    T Function(Object? json) fromJsonT,\n  ) => _$ApiResponseFromJson(json, fromJsonT);\n  \n  Map<String, dynamic> toJson(Object? Function(T value) toJsonT) =>\n      _$ApiResponseToJson(this, toJsonT);\n  \n  bool get hasData => success && data != null;\n  bool get hasError => !success || error != null;\n}\n\n@JsonSerializable()\nclass ApiError {\n  final String code;\n  final String message;\n  final Map<String, dynamic>? details;\n  \n  const ApiError({\n    required this.code,\n    required this.message,\n    this.details,\n  });\n  \n  factory ApiError.fromJson(Map<String, dynamic> json) =>\n      _$ApiErrorFromJson(json);\n  \n  Map<String, dynamic> toJson() => _$ApiErrorToJson(this);\n}\n```\n\n**lib/core/models/pagination.dart:**\n```dart\nimport 'package:json_annotation/json_annotation.dart';\n\npart 'pagination.g.dart';\n\n@JsonSerializable(genericArgumentFactories: true)\nclass PaginatedResponse<T> {\n  final List<T> items;\n  final PaginationMeta pagination;\n  \n  const PaginatedResponse({\n    required this.items,\n    required this.pagination,\n  });\n  \n  factory PaginatedResponse.fromJson(\n    Map<String, dynamic> json,\n    T Function(Object? json) fromJsonT,\n  ) => _$PaginatedResponseFromJson(json, fromJsonT);\n  \n  Map<String, dynamic> toJson(Object? Function(T value) toJsonT) =>\n      _$PaginatedResponseToJson(this, toJsonT);\n  \n  bool get hasMore => pagination.hasNextPage;\n  bool get isEmpty => items.isEmpty;\n  int get total => pagination.total;\n}\n\n@JsonSerializable()\nclass PaginationMeta {\n  final int page;\n  final int limit;\n  final int total;\n  final int totalPages;\n  \n  const PaginationMeta({\n    required this.page,\n    required this.limit,\n    required this.total,\n    required this.totalPages,\n  });\n  \n  factory PaginationMeta.fromJson(Map<String, dynamic> json) =>\n      _$PaginationMetaFromJson(json);\n  \n  Map<String, dynamic> toJson() => _$PaginationMetaToJson(this);\n  \n  bool get hasNextPage => page < totalPages;\n  bool get hasPreviousPage => page > 1;\n  bool get isFirstPage => page == 1;\n  bool get isLastPage => page == totalPages;\n}\n\nclass PaginationParams {\n  final int page;\n  final int limit;\n  \n  const PaginationParams({\n    this.page = 1,\n    this.limit = 20,\n  });\n  \n  Map<String, dynamic> toQueryParameters() => {\n    'page': page.toString(),\n    'limit': limit.toString(),\n  };\n  \n  PaginationParams copyWith({int? page, int? limit}) => PaginationParams(\n    page: page ?? this.page,\n    limit: limit ?? this.limit,\n  );\n  \n  PaginationParams get nextPage => copyWith(page: page + 1);\n}\n```\n\n**lib/core/providers/providers.dart:**\n```dart\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\nimport 'package:flutter_secure_storage/flutter_secure_storage.dart';\nimport '../network/dio_client.dart';\n\n// Secure Storage Provider\nfinal secureStorageProvider = Provider<FlutterSecureStorage>((ref) {\n  return const FlutterSecureStorage(\n    aOptions: AndroidOptions(encryptedSharedPreferences: true),\n    iOptions: IOSOptions(accessibility: KeychainAccessibility.first_unlock),\n  );\n});\n\n// Dio Client Provider\nfinal dioClientProvider = Provider<DioClient>((ref) {\n  final storage = ref.watch(secureStorageProvider);\n  return DioClient(storage: storage);\n});\n\n// App Lifecycle Provider (for managing app state)\nfinal appLifecycleProvider = StateProvider<AppLifecycleState>((ref) {\n  return AppLifecycleState.resumed;\n});\n```\n\n**lib/main.dart:**\n```dart\nimport 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\nimport 'core/config/environment.dart';\nimport 'core/utils/logger.dart';\n\nvoid main() async {\n  // Ensure Flutter binding is initialized\n  WidgetsFlutterBinding.ensureInitialized();\n  \n  // Set preferred orientations\n  await SystemChrome.setPreferredOrientations([\n    DeviceOrientation.portraitUp,\n    DeviceOrientation.portraitDown,\n  ]);\n  \n  // Initialize environment configuration\n  try {\n    await Environment.initialize();\n    AppLogger.info('Environment initialized: ${Environment.instance.type.name}');\n  } catch (e, stackTrace) {\n    AppLogger.error(\n      'Failed to initialize environment',\n      error: e,\n      stackTrace: stackTrace,\n    );\n  }\n  \n  // Run the app with Riverpod\n  runApp(\n    const ProviderScope(\n      child: PasosApp(),\n    ),\n  );\n}\n\nclass PasosApp extends StatelessWidget {\n  const PasosApp({super.key});\n  \n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Pasos',\n      debugShowCheckedModeBanner: false,\n      theme: ThemeData(\n        colorScheme: ColorScheme.fromSeed(\n          seedColor: Colors.blue,\n          brightness: Brightness.light,\n        ),\n        useMaterial3: true,\n      ),\n      darkTheme: ThemeData(\n        colorScheme: ColorScheme.fromSeed(\n          seedColor: Colors.blue,\n          brightness: Brightness.dark,\n        ),\n        useMaterial3: true,\n      ),\n      themeMode: ThemeMode.system,\n      home: const _PlaceholderHome(),\n    );\n  }\n}\n\n// Temporary placeholder - will be replaced by actual screens in UI Foundation epic\nclass _PlaceholderHome extends StatelessWidget {\n  const _PlaceholderHome();\n  \n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Pasos'),\n        centerTitle: true,\n      ),\n      body: Center(\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(\n              Icons.directions_walk,\n              size: 80,\n              color: Theme.of(context).colorScheme.primary,\n            ),\n            const SizedBox(height: 24),\n            Text(\n              'Pasos',\n              style: Theme.of(context).textTheme.headlineLarge,\n            ),\n            const SizedBox(height: 8),\n            Text(\n              'Step tracking app',\n              style: Theme.of(context).textTheme.bodyLarge?.copyWith(\n                color: Theme.of(context).colorScheme.onSurfaceVariant,\n              ),\n            ),\n            const SizedBox(height: 48),\n            Text(\n              'Foundation setup complete!',\n              style: Theme.of(context).textTheme.bodyMedium,\n            ),\n            Text(\n              'UI Foundation epic will add routing and theming.',\n              style: Theme.of(context).textTheme.bodySmall?.copyWith(\n                color: Theme.of(context).colorScheme.outline,\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n```\n\nüß™ **VERIFICATION:**\n1. `flutter pub get` - Dependencies resolve\n2. `dart run build_runner build` - Generates .g.dart files for models\n3. `flutter analyze` - No errors in any file\n4. `flutter run` - App launches and shows placeholder screen\n5. Check console for 'Environment initialized' log message",
        "epicId": "epic-flutter-foundation",
        "priority": 5,
        "estimatedComplexity": "moderate",
        "dependencies": [
          "epic-flutter-foundation-story-1",
          "epic-flutter-foundation-story-2",
          "epic-flutter-foundation-story-3",
          "epic-flutter-foundation-story-4"
        ],
        "status": "pending",
        "filesToRead": [
          "lib/core/config/environment.dart",
          "lib/core/network/dio_client.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/models/api_response.dart",
          "lib/core/models/pagination.dart",
          "lib/core/providers/providers.dart",
          "lib/main.dart"
        ],
        "acceptanceCriteria": [
          "Given api_response.dart exists, When deserializing API responses, Then ApiResponse<T> correctly parses success, data, and error fields",
          "Given pagination.dart exists, When handling paginated lists, Then PaginatedResponse<T> provides hasMore, total, and navigation helpers",
          "Given providers.dart exists, When accessing dioClientProvider, Then a singleton DioClient with FlutterSecureStorage is returned",
          "Given main.dart exists, When running flutter run, Then app initializes environment, wraps with ProviderScope, and displays Material3 themed UI"
        ]
      }
    ]
  }
}