{
  "_metadata": {
    "agentType": "techlead",
    "taskId": "19afc0eeb32fa408ae69dddf",
    "timestamp": "2026-01-25T16:34:48.664Z",
    "phase": "techlead",
    "epicId": "epic-flutter-foundation",
    "savedAt": "2026-01-25T16:34:48.665Z",
    "version": "1.0"
  },
  "data": {
    "epicId": "epic-flutter-foundation",
    "storiesCount": 5,
    "architecture": "## Flutter Foundation Architecture\n\n### Pattern: Feature-First with Clean Architecture Layers\n\nThe foundation follows a modular, feature-first architecture with clear separation of concerns:\n\n```\nlib/\n‚îú‚îÄ‚îÄ main.dart                    # Entry point\n‚îú‚îÄ‚îÄ app.dart                     # Root App widget\n‚îú‚îÄ‚îÄ core/                        # Shared core functionality\n‚îÇ   ‚îú‚îÄ‚îÄ config/                  # App configuration & DI\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_config.dart      # GetIt service locator\n‚îÇ   ‚îú‚îÄ‚îÄ constants/               # App-wide constants (EXISTING)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_constants.dart   # Timeouts, limits\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_endpoints.dart   # API paths\n‚îÇ   ‚îú‚îÄ‚îÄ env/                     # Environment config (EXISTING)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env_config.dart      # dotenv wrapper\n‚îÇ   ‚îú‚îÄ‚îÄ error/                   # Error handling (EXISTING)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.dart      # Exception classes\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ failures.dart        # Failure classes for Either\n‚îÇ   ‚îú‚îÄ‚îÄ network/                 # HTTP client layer\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dio_client.dart      # Dio wrapper\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_interceptor.dart # Request/response interceptor\n‚îÇ   ‚îú‚îÄ‚îÄ platform/                # Platform utilities (EXISTING)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ platform_config.dart # Platform detection\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health_permissions.dart # Health API permissions\n‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # Utility classes\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.dart          # Logging wrapper\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators.dart      # Input validation\n‚îÇ   ‚îî‚îÄ‚îÄ extensions/              # Dart extensions\n‚îÇ       ‚îú‚îÄ‚îÄ string_extensions.dart\n‚îÇ       ‚îî‚îÄ‚îÄ context_extensions.dart\n‚îî‚îÄ‚îÄ features/                    # Feature modules (future)\n```\n\n### Dependency Injection Strategy\n- **GetIt** for service location (singleton pattern)\n- Services registered in `AppConfig.init()` at startup\n- Lazy initialization for expensive services\n\n### Network Layer Design\n- **Dio** HTTP client with centralized configuration\n- **ApiInterceptor** handles:\n  - Auth token injection\n  - Request/response logging\n  - Error conversion to typed exceptions\n- Timeout values from `AppConstants`\n- Base URL from `EnvConfig.apiUrl`\n\n### Error Handling Strategy\n- **Exceptions** thrown at data layer (network, cache)\n- **Failures** returned via Either type at repository layer\n- Typed exceptions: `ServerException`, `NetworkException`, `UnauthorizedException`, `CacheException`\n\n### Environment Configuration\n- `.env` file loaded via `flutter_dotenv`\n- `EnvConfig` provides typed access to environment variables\n- Supports: development, staging, production environments\n\n### Verification Commands\n- Typecheck/Analyze: `flutter analyze`\n- Build: `flutter build apk --debug`\n- Test: `flutter test`",
    "stories": [
      {
        "id": "epic-flutter-foundation-story-1",
        "title": "Create lib/main.dart and lib/app.dart application entry point",
        "description": "Create the Flutter application entry point (main.dart) and root App widget (app.dart).\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/env/env_config.dart, pubspec.yaml\n- Modify: none\n- Create: lib/main.dart, lib/app.dart\n\nüîß **PATTERNS TO USE:**\n- Use EnvConfig from lib/env/env_config.dart for environment access\n- Use flutter_dotenv for loading .env: await dotenv.load(fileName: '.env')\n- Follow abstract final class pattern from existing codebase\n- Use WidgetsFlutterBinding.ensureInitialized() before dotenv.load()\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n- main.dart must:\n  - Call WidgetsFlutterBinding.ensureInitialized()\n  - Load dotenv file: await dotenv.load(fileName: '.env')\n  - Call runApp(const App())\n- app.dart must:\n  - Create stateless App widget\n  - Use MaterialApp with theme\n  - Set debugShowCheckedModeBanner based on EnvConfig.isProduction\n  - Use AppConstants.appName for title\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Hardcoding app name instead of using AppConstants.appName\n- Forgetting WidgetsFlutterBinding.ensureInitialized()\n- Using print() instead of logger (add TODO comment for now)\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- App launches with MaterialApp\n- Environment variables loaded from .env\n- Debug banner hidden in production\n- Theme configured with Material 3\n\nüß™ **VERIFICATION:**\n- Run: flutter analyze lib/main.dart lib/app.dart\n- Run: flutter build apk --debug (should compile)\n- No analyzer errors or warnings",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/env/env_config.dart",
          "pubspec.yaml",
          "lib/core/constants/app_constants.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/main.dart",
          "lib/app.dart"
        ],
        "acceptanceCriteria": [
          "Given the app starts, When main() is called, Then dotenv loads .env file before runApp",
          "Given the App widget builds, When MaterialApp renders, Then it uses AppConstants.appName as title",
          "Given production environment, When app builds, Then debugShowCheckedModeBanner is false",
          "Given flutter analyze runs, When checking lib/main.dart and lib/app.dart, Then no errors are reported"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-2",
        "title": "Create lib/core/config/app_config.dart with GetIt service locator",
        "description": "Create the application configuration with dependency injection using GetIt service locator.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/env/env_config.dart, lib/core/constants/app_constants.dart, pubspec.yaml\n- Modify: none\n- Create: lib/core/config/app_config.dart\n\nüîß **PATTERNS TO USE:**\n- Use GetIt for dependency injection (already in pubspec.yaml)\n- Use abstract final class pattern (see AppConstants, EnvConfig)\n- Provide static methods for initialization and service access\n- Use late initialization pattern for services\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n- AppConfig class must have:\n  - Static GetIt instance: static final GetIt _getIt = GetIt.instance\n  - Static getter: static GetIt get instance => _getIt\n  - Future<void> init() async method to register all services\n  - Generic T get<T extends Object>() method\n  - bool isRegistered<T extends Object>() method\n  - void reset() method for testing\n- Services to register (as singletons):\n  - Register placeholder for DioClient (TODO comment for story-3)\n  - Register placeholder for Logger (TODO comment for story-4)\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Using global variables instead of GetIt\n- Not making class abstract final\n- Forgetting to handle already-registered services in reset()\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- GetIt instance accessible via AppConfig.instance\n- init() can be called once at app startup\n- get<T>() retrieves registered services\n- reset() clears all registrations (for tests)\n\nüß™ **VERIFICATION:**\n- Run: flutter analyze lib/core/config/app_config.dart\n- No analyzer errors or warnings",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/env/env_config.dart",
          "lib/core/constants/app_constants.dart",
          "pubspec.yaml"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/config/app_config.dart"
        ],
        "acceptanceCriteria": [
          "Given AppConfig.init() is called, When services are registered, Then GetIt contains all registered services",
          "Given a service is registered, When AppConfig.get<ServiceType>() is called, Then the correct instance is returned",
          "Given AppConfig.reset() is called, When checking registrations, Then all services are cleared",
          "Given flutter analyze runs, When checking app_config.dart, Then no errors are reported"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-3",
        "title": "Create lib/core/network/dio_client.dart and api_interceptor.dart HTTP client",
        "description": "Create the Dio HTTP client with request/response interceptors for API communication.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/env/env_config.dart, lib/core/constants/app_constants.dart, lib/core/constants/api_endpoints.dart, lib/core/error/exceptions.dart\n- Modify: none\n- Create: lib/core/network/dio_client.dart, lib/core/network/api_interceptor.dart\n\nüîß **PATTERNS TO USE:**\n- Use Dio package (already in pubspec.yaml: dio: ^5.4.0)\n- Use EnvConfig.apiUrl for baseUrl\n- Use AppConstants.connectionTimeout for connectTimeout\n- Use AppConstants.receiveTimeout for receiveTimeout\n- Use exceptions from lib/core/error/exceptions.dart (ServerException, NetworkException, UnauthorizedException)\n- Use connectivity_plus for network checking\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**api_interceptor.dart:**\n- ApiInterceptor class extends Interceptor\n- onRequest: Add auth token header (placeholder), log request in debug mode\n- onResponse: Log response in debug mode\n- onError: Convert DioException to appropriate AppException (ServerException, NetworkException, UnauthorizedException)\n\n**dio_client.dart:**\n- DioClient class with:\n  - Late final Dio _dio instance\n  - Constructor that configures Dio with BaseOptions\n  - BaseOptions: baseUrl from EnvConfig.apiUrl, connectTimeout, receiveTimeout, headers\n  - Adds ApiInterceptor\n  - get<T>(), post<T>(), put<T>(), delete<T>() methods\n  - Methods should handle responses and throw appropriate exceptions\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Hardcoding URLs instead of using EnvConfig.apiUrl\n- Hardcoding timeouts instead of using AppConstants\n- Using generic Exception instead of typed exceptions from exceptions.dart\n- Not converting DioException to app-specific exceptions\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- DioClient configures base URL from environment\n- Timeouts use AppConstants values\n- ApiInterceptor logs requests/responses in debug mode\n- Network errors throw NetworkException\n- Server errors (5xx) throw ServerException\n- Auth errors (401/403) throw UnauthorizedException\n\nüß™ **VERIFICATION:**\n- Run: flutter analyze lib/core/network/\n- No analyzer errors or warnings",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/env/env_config.dart",
          "lib/core/constants/app_constants.dart",
          "lib/core/constants/api_endpoints.dart",
          "lib/core/error/exceptions.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/network/dio_client.dart",
          "lib/core/network/api_interceptor.dart"
        ],
        "acceptanceCriteria": [
          "Given DioClient is instantiated, When checking baseUrl, Then it equals EnvConfig.apiUrl",
          "Given a 500 response, When onError intercepts, Then ServerException is thrown with correct message",
          "Given a 401 response, When onError intercepts, Then UnauthorizedException.sessionExpired() pattern is used",
          "Given no network connection, When request fails, Then NetworkException.noConnection() is thrown",
          "Given flutter analyze runs, When checking network files, Then no errors are reported"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-4",
        "title": "Create lib/core/utils/logger.dart and validators.dart utility classes",
        "description": "Create logging utility using logger package and input validators for forms.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/env/env_config.dart, lib/core/constants/app_constants.dart, pubspec.yaml\n- Modify: none\n- Create: lib/core/utils/logger.dart, lib/core/utils/validators.dart\n\nüîß **PATTERNS TO USE:**\n- Use logger package (already in pubspec.yaml: logger: ^2.0.2+1)\n- Use EnvConfig.enableLogging and EnvConfig.isProduction for log filtering\n- Use abstract final class pattern (see existing files)\n- Use AppConstants.minPasswordLength and maxPasswordLength\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**logger.dart:**\n- AppLogger class (abstract final)\n- Static late Logger _logger instance\n- Static init() method that configures Logger based on environment\n- In production: use PrettyPrinter with minimal output\n- In development: use PrettyPrinter with full output\n- Static methods: debug(), info(), warning(), error()\n- Each method checks EnvConfig.enableLogging before logging\n\n**validators.dart:**\n- Validators class (abstract final)\n- Static email(String? value) -> String? (returns error message or null)\n  - Check empty, use RegExp for email validation\n- Static password(String? value) -> String? \n  - Check empty, min length (AppConstants.minPasswordLength), max length\n  - Check has uppercase, lowercase, number\n- Static required(String? value, String fieldName) -> String?\n- Static minLength(String? value, int min, String fieldName) -> String?\n- Static maxLength(String? value, int max, String fieldName) -> String?\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Using print() instead of Logger\n- Hardcoding password length instead of using AppConstants\n- Not checking EnvConfig.enableLogging before logging\n- Returning bool from validators instead of error message String?\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- AppLogger respects EnvConfig.enableLogging setting\n- Production mode has less verbose logging\n- Validators return null for valid input, error message for invalid\n- Password validation enforces AppConstants requirements\n\nüß™ **VERIFICATION:**\n- Run: flutter analyze lib/core/utils/\n- No analyzer errors or warnings",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/env/env_config.dart",
          "lib/core/constants/app_constants.dart",
          "pubspec.yaml"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/utils/logger.dart",
          "lib/core/utils/validators.dart"
        ],
        "acceptanceCriteria": [
          "Given EnvConfig.enableLogging is false, When AppLogger.info() is called, Then nothing is logged",
          "Given valid email 'test@example.com', When Validators.email() is called, Then null is returned",
          "Given invalid email 'invalid', When Validators.email() is called, Then error message is returned",
          "Given password shorter than AppConstants.minPasswordLength, When Validators.password() is called, Then error message about length is returned",
          "Given flutter analyze runs, When checking utils files, Then no errors are reported"
        ]
      },
      {
        "id": "epic-flutter-foundation-story-5",
        "title": "Create lib/core/extensions/string_extensions.dart and context_extensions.dart",
        "description": "Create Dart extension methods for String and BuildContext for cleaner code.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: lib/core/utils/validators.dart (for pattern reference)\n- Modify: none\n- Create: lib/core/extensions/string_extensions.dart, lib/core/extensions/context_extensions.dart\n\nüîß **PATTERNS TO USE:**\n- Use Dart extension syntax: extension StringExtensions on String\n- Follow existing codebase documentation patterns with /// comments\n- Import 'package:flutter/material.dart' for BuildContext extensions\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**string_extensions.dart:**\n- extension StringExtensions on String\n- bool get isValidEmail -> uses RegExp to validate email format\n- bool get isNotBlank -> trims and checks if not empty\n- bool get isBlank -> trims and checks if empty\n- String get capitalize -> capitalizes first letter\n- String get capitalizeWords -> capitalizes first letter of each word\n- String truncate(int maxLength, {String suffix = '...'}) -> truncates with suffix\n- int? get toIntOrNull -> parses to int or returns null\n- double? get toDoubleOrNull -> parses to double or returns null\n\n**context_extensions.dart:**\n- extension ContextExtensions on BuildContext\n- ThemeData get theme -> Theme.of(this)\n- TextTheme get textTheme -> Theme.of(this).textTheme\n- ColorScheme get colorScheme -> Theme.of(this).colorScheme\n- MediaQueryData get mediaQuery -> MediaQuery.of(this)\n- Size get screenSize -> mediaQuery.size\n- double get screenWidth -> screenSize.width\n- double get screenHeight -> screenSize.height\n- bool get isKeyboardOpen -> mediaQuery.viewInsets.bottom > 0\n- void showSnackBar(String message, {bool isError = false}) -> ScaffoldMessenger.of(this).showSnackBar(...)\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Forgetting 'on String' or 'on BuildContext' in extension declaration\n- Not handling null or edge cases in string parsing\n- Using deprecated Flutter APIs\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- String extensions work on any String instance\n- Context extensions provide convenient access to theme and media query\n- showSnackBar displays error style when isError is true\n- All extensions have documentation comments\n\nüß™ **VERIFICATION:**\n- Run: flutter analyze lib/core/extensions/\n- No analyzer errors or warnings",
        "epicId": "epic-flutter-foundation",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/core/utils/validators.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/extensions/string_extensions.dart",
          "lib/core/extensions/context_extensions.dart"
        ],
        "acceptanceCriteria": [
          "Given string 'hello', When .capitalize is called, Then 'Hello' is returned",
          "Given string '  ', When .isBlank is called, Then true is returned",
          "Given string 'test@example.com', When .isValidEmail is called, Then true is returned",
          "Given BuildContext, When .theme is called, Then ThemeData is returned",
          "Given BuildContext, When .screenWidth is called, Then screen width double is returned",
          "Given flutter analyze runs, When checking extensions files, Then no errors are reported"
        ]
      }
    ]
  }
}