{
  "_metadata": {
    "agentType": "techlead",
    "taskId": "4779e64c71a87c9df959194c",
    "timestamp": "2026-01-25T15:50:02.739Z",
    "phase": "techlead",
    "epicId": "epic-ui-foundation",
    "savedAt": "2026-01-25T15:50:02.739Z",
    "version": "1.0"
  },
  "data": {
    "epicId": "epic-ui-foundation",
    "storiesCount": 5,
    "architecture": "## UI Foundation Architecture\n\n### Layer Structure (Clean Architecture)\n```\nlib/\n‚îú‚îÄ‚îÄ main.dart                    # App entry point\n‚îú‚îÄ‚îÄ app.dart                     # MaterialApp configuration\n‚îú‚îÄ‚îÄ core/\n‚îÇ   ‚îú‚îÄ‚îÄ constants/               # App-wide constants (EXISTING)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_constants.dart   # (MODIFY - add widget constants)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_endpoints.dart   # (READ ONLY)\n‚îÇ   ‚îú‚îÄ‚îÄ di/                      # Dependency Injection\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ injection_container.dart\n‚îÇ   ‚îú‚îÄ‚îÄ error/                   # Error handling (foundation)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ failures.dart        # Failure types (Equatable)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.dart      # Exception types\n‚îÇ   ‚îú‚îÄ‚îÄ network/                 # HTTP layer\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ network_info.dart    # Connectivity checking\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_interceptors.dart # Auth, logging, error interceptors\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_client.dart      # Dio wrapper with Either<Failure, T>\n‚îÇ   ‚îú‚îÄ‚îÄ router/                  # Navigation\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route_names.dart     # Named route constants\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_router.dart      # Route generation\n‚îÇ   ‚îú‚îÄ‚îÄ theme/                   # Design system\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_colors.dart      # Color palette\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_typography.dart  # Text styles\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_theme.dart       # ThemeData configuration\n‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # Utilities\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.dart      # Form validation\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.dart      # Number/date formatting\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ extensions.dart      # Dart extensions\n‚îÇ   ‚îî‚îÄ‚îÄ widgets/                 # Reusable widgets\n‚îÇ       ‚îú‚îÄ‚îÄ app_button.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_text_field.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_card.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_loading.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_error.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_empty_state.dart\n‚îÇ       ‚îú‚îÄ‚îÄ app_avatar.dart\n‚îÇ       ‚îî‚îÄ‚îÄ app_bottom_nav.dart\n‚îî‚îÄ‚îÄ env/                         # Environment (EXISTING)\n    ‚îî‚îÄ‚îÄ env_config.dart          # (READ ONLY)\n```\n\n### Design Patterns\n1. **abstract final class** - For utility/constant classes (matches existing codebase)\n2. **Dependency Injection** - get_it service locator pattern\n3. **Either<Failure, T>** - Functional error handling with dartz\n4. **Factory constructors** - Convenient widget variants\n5. **Material 3** - Full Material 3 design compliance\n\n### Dependencies (from pubspec.yaml)\n- get_it: ^7.6.7 (DI)\n- dio: ^5.4.0 (HTTP)\n- connectivity_plus: ^5.0.2 (Network)\n- flutter_dotenv: ^5.1.0 (Env)\n- equatable: ^2.0.5 (Value equality)\n- dartz: ^0.10.1 (Functional programming)\n- logger: ^2.0.2+1 (Logging)\n\n### Story Dependency Graph\n```\nStory 1 (Error)     Story 2 (Theme)     Story 3 (Router+Utils)\n       \\                  |                    /\n        \\                 |                   /\n         v                v                  v\n       Story 4 (Network) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n                          \\\n                           v\n                    Story 5 (Widgets + Bootstrap)\n```\n\n### SOLID Compliance\n- **SRP**: Each file has single responsibility (colors, typography, validators, etc.)\n- **OCP**: Widgets use factory constructors for variants without modification\n- **LSP**: All Failure types are substitutable for base Failure class\n- **ISP**: NetworkInfo interface is minimal (isConnected, onConnectivityChanged)\n- **DIP**: ApiClient depends on NetworkInfo abstraction, not NetworkInfoImpl",
    "stories": [
      {
        "id": "epic-ui-foundation-story-1",
        "title": "Create Error Handling Foundation with Failures and Exceptions in lib/core/error/",
        "description": "**Description:**\nImplement the foundational error handling layer using dartz Either type for functional error handling. This establishes the base classes for all app failures and exceptions.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart), [lib/env/env_config.dart](lib/env/env_config.dart)\n- Modify: none\n- Create: [lib/core/error/failures.dart](lib/core/error/failures.dart), [lib/core/error/exceptions.dart](lib/core/error/exceptions.dart)\n\nüîß **PATTERNS TO USE:**\n- Use `abstract final class` pattern from existing code (see AppConstants)\n- Use `equatable` for value equality in Failure classes\n- Use snake_case for file names\n- Add comprehensive `///` documentation with example usage blocks\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**lib/core/error/failures.dart:**\n```dart\n// Base Failure class extending Equatable\nabstract class Failure extends Equatable {\n  final String message;\n  final int? code;\n  const Failure({required this.message, this.code});\n  @override\n  List<Object?> get props => [message, code];\n}\n\n// Concrete failures:\n// - ServerFailure (API errors, status codes)\n// - CacheFailure (local storage errors)\n// - NetworkFailure (connectivity issues)\n// - ValidationFailure (input validation)\n// - AuthenticationFailure (auth errors)\n// - UnknownFailure (catch-all)\n```\n\n**lib/core/error/exceptions.dart:**\n```dart\n// Base exception class\nabstract class AppException implements Exception {\n  final String message;\n  final int? statusCode;\n  const AppException({required this.message, this.statusCode});\n}\n\n// Concrete exceptions:\n// - ServerException\n// - CacheException\n// - NetworkException\n// - UnauthorizedException\n// - NotFoundException\n```\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Do NOT use generic Exception class directly\n- Do NOT forget to extend Equatable for Failure classes\n- Do NOT use mutable fields - all properties must be final\n- Do NOT create files outside lib/core/error/\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- Failure classes must extend Equatable for proper comparison\n- Each failure type must have descriptive message and optional code\n- Exception classes must implement Exception interface\n- All classes must have factory constructors where appropriate\n- Include `fromException()` factory methods for converting exceptions to failures\n\nüß™ **VERIFICATION:**\n```bash\nflutter analyze lib/core/error/\nflutter test --no-pub\n```\n- Verify no analyzer warnings/errors\n- Verify Equatable props are correctly implemented",
        "epicId": "epic-ui-foundation",
        "priority": 1,
        "estimatedComplexity": "simple",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/app_constants.dart",
          "lib/env/env_config.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/error/failures.dart",
          "lib/core/error/exceptions.dart"
        ],
        "acceptanceCriteria": [
          "Given the failures.dart file, When imported, Then it exports Failure base class and all concrete failure types (ServerFailure, CacheFailure, NetworkFailure, ValidationFailure, AuthenticationFailure, UnknownFailure)",
          "Given the exceptions.dart file, When imported, Then it exports AppException base class and all concrete exception types (ServerException, CacheException, NetworkException, UnauthorizedException, NotFoundException)",
          "Given two Failure instances with same properties, When compared with ==, Then they are equal (Equatable working)",
          "Given a ServerException, When ServerFailure.fromException() is called, Then it creates a ServerFailure with matching message and code",
          "Given flutter analyze lib/core/error/, When executed, Then no errors or warnings are reported"
        ]
      },
      {
        "id": "epic-ui-foundation-story-2",
        "title": "Create Theme System with Colors, Typography, and AppTheme in lib/core/theme/",
        "description": "**Description:**\nImplement the complete Material 3 design system with color palette, typography scale, and unified theme configuration. This establishes the visual foundation for all UI components.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart)\n- Modify: none\n- Create: [lib/core/theme/app_colors.dart](lib/core/theme/app_colors.dart), [lib/core/theme/app_typography.dart](lib/core/theme/app_typography.dart), [lib/core/theme/app_theme.dart](lib/core/theme/app_theme.dart)\n\nüîß **PATTERNS TO USE:**\n- Use `abstract final class` pattern for AppColors and AppTypography\n- Use MaterialColor and ColorScheme for Material 3 compliance\n- Use TextTheme with Google Fonts or system fonts\n- Add comprehensive `///` documentation with example usage blocks\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**lib/core/theme/app_colors.dart:**\n```dart\nabstract final class AppColors {\n  // Primary palette (health/fitness green theme)\n  static const Color primary = Color(0xFF4CAF50);\n  static const Color primaryLight = Color(0xFF81C784);\n  static const Color primaryDark = Color(0xFF388E3C);\n  \n  // Secondary palette (energetic orange accents)\n  static const Color secondary = Color(0xFFFF9800);\n  \n  // Semantic colors\n  static const Color success = Color(0xFF4CAF50);\n  static const Color warning = Color(0xFFFFC107);\n  static const Color error = Color(0xFFF44336);\n  static const Color info = Color(0xFF2196F3);\n  \n  // Neutral colors\n  static const Color background = Color(0xFFFAFAFA);\n  static const Color surface = Color(0xFFFFFFFF);\n  static const Color textPrimary = Color(0xFF212121);\n  static const Color textSecondary = Color(0xFF757575);\n  static const Color divider = Color(0xFFBDBDBD);\n  \n  // Dark theme variants\n  static const Color backgroundDark = Color(0xFF121212);\n  static const Color surfaceDark = Color(0xFF1E1E1E);\n  // ... etc\n}\n```\n\n**lib/core/theme/app_typography.dart:**\n```dart\nabstract final class AppTypography {\n  static const String fontFamily = 'Roboto';\n  \n  // Display styles\n  static const TextStyle displayLarge = TextStyle(...);\n  static const TextStyle displayMedium = TextStyle(...);\n  \n  // Headline styles\n  static const TextStyle headlineLarge = TextStyle(...);\n  // ... etc\n  \n  // Body styles\n  static const TextStyle bodyLarge = TextStyle(...);\n  // ... etc\n  \n  // Label styles\n  static const TextStyle labelLarge = TextStyle(...);\n  // ... etc\n}\n```\n\n**lib/core/theme/app_theme.dart:**\n```dart\nabstract final class AppTheme {\n  static ThemeData get lightTheme => ThemeData(\n    useMaterial3: true,\n    colorScheme: ColorScheme.fromSeed(\n      seedColor: AppColors.primary,\n      brightness: Brightness.light,\n    ),\n    textTheme: _textTheme,\n    // Component themes...\n  );\n  \n  static ThemeData get darkTheme => ThemeData(\n    useMaterial3: true,\n    colorScheme: ColorScheme.fromSeed(\n      seedColor: AppColors.primary,\n      brightness: Brightness.dark,\n    ),\n    textTheme: _textTheme,\n    // Component themes...\n  );\n  \n  static TextTheme get _textTheme => TextTheme(\n    displayLarge: AppTypography.displayLarge,\n    // ... map all typography styles\n  );\n}\n```\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Do NOT hardcode colors in widgets - always use AppColors\n- Do NOT use deprecated ThemeData properties\n- Do NOT forget dark theme support\n- Do NOT create files outside lib/core/theme/\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- Complete Material 3 ColorScheme with light and dark variants\n- Full TextTheme with all 15 text styles (display, headline, title, body, label)\n- ElevatedButton, TextButton, OutlinedButton theme customization\n- InputDecoration theme for TextFields\n- AppBar, Card, Scaffold theme customization\n- Consistent 8px grid spacing system\n\nüß™ **VERIFICATION:**\n```bash\nflutter analyze lib/core/theme/\nflutter test --no-pub\n```\n- Verify AppTheme.lightTheme and AppTheme.darkTheme compile without errors\n- Verify all colors are accessible (AA contrast ratio for text)",
        "epicId": "epic-ui-foundation",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/app_constants.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/theme/app_colors.dart",
          "lib/core/theme/app_typography.dart",
          "lib/core/theme/app_theme.dart"
        ],
        "acceptanceCriteria": [
          "Given AppColors class, When accessed, Then it provides all semantic colors (primary, secondary, success, warning, error, info) and neutral colors for both light and dark themes",
          "Given AppTypography class, When accessed, Then it provides complete Material 3 text scale (displayLarge through labelSmall - 15 styles total)",
          "Given AppTheme.lightTheme, When applied to MaterialApp, Then app renders with light color scheme and proper text styling",
          "Given AppTheme.darkTheme, When applied to MaterialApp, Then app renders with dark color scheme and proper text styling",
          "Given flutter analyze lib/core/theme/, When executed, Then no errors or warnings are reported"
        ]
      },
      {
        "id": "epic-ui-foundation-story-3",
        "title": "Create Routing System and Utility Functions in lib/core/router/ and lib/core/utils/",
        "description": "**Description:**\nImplement the navigation router with named routes and utility functions for validation, formatting, and Dart extensions. Uses Navigator 2.0 patterns for declarative routing.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart), [lib/core/constants/api_endpoints.dart](lib/core/constants/api_endpoints.dart)\n- Modify: none\n- Create: [lib/core/router/route_names.dart](lib/core/router/route_names.dart), [lib/core/router/app_router.dart](lib/core/router/app_router.dart), [lib/core/utils/validators.dart](lib/core/utils/validators.dart), [lib/core/utils/formatters.dart](lib/core/utils/formatters.dart), [lib/core/utils/extensions.dart](lib/core/utils/extensions.dart)\n\nüîß **PATTERNS TO USE:**\n- Use `abstract final class` pattern for RouteNames, Validators, Formatters\n- Use extension methods pattern for Dart extensions\n- Reference AppConstants.minPasswordLength and maxPasswordLength for validators\n- Add comprehensive `///` documentation with example usage blocks\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**lib/core/router/route_names.dart:**\n```dart\nabstract final class RouteNames {\n  // Auth routes\n  static const String splash = '/splash';\n  static const String login = '/login';\n  static const String register = '/register';\n  static const String forgotPassword = '/forgot-password';\n  \n  // Main app routes\n  static const String home = '/home';\n  static const String dashboard = '/dashboard';\n  static const String profile = '/profile';\n  static const String settings = '/settings';\n  \n  // Feature routes\n  static const String steps = '/steps';\n  static const String stepHistory = '/steps/history';\n  static const String groups = '/groups';\n  static const String groupDetail = '/groups/:id';\n  static const String leaderboard = '/leaderboard';\n  static const String goals = '/goals';\n}\n```\n\n**lib/core/router/app_router.dart:**\n```dart\nclass AppRouter {\n  static final GlobalKey<NavigatorState> navigatorKey = GlobalKey();\n  \n  static Route<dynamic> onGenerateRoute(RouteSettings settings) {\n    switch (settings.name) {\n      case RouteNames.splash:\n        return MaterialPageRoute(builder: (_) => const Placeholder());\n      case RouteNames.login:\n        return MaterialPageRoute(builder: (_) => const Placeholder());\n      // ... all routes return Placeholder() for now\n      // Feature screens will be implemented in future epics\n      default:\n        return MaterialPageRoute(builder: (_) => const _UnknownRoutePage());\n    }\n  }\n  \n  // Navigation helpers\n  static Future<T?> pushNamed<T>(String routeName, {Object? arguments});\n  static void pop<T>([T? result]);\n  static Future<T?> pushReplacementNamed<T, TO>(String routeName);\n  static void popUntil(String routeName);\n}\n\nclass _UnknownRoutePage extends StatelessWidget {...}\n```\n\n**lib/core/utils/validators.dart:**\n```dart\nabstract final class Validators {\n  static String? email(String? value);\n  static String? password(String? value); // Uses AppConstants.minPasswordLength\n  static String? confirmPassword(String? value, String? password);\n  static String? required(String? value, [String fieldName = 'Field']);\n  static String? minLength(String? value, int min);\n  static String? maxLength(String? value, int max);\n  static String? numeric(String? value);\n  static String? phoneNumber(String? value);\n}\n```\n\n**lib/core/utils/formatters.dart:**\n```dart\nabstract final class Formatters {\n  static String number(num value, {int decimals = 0});\n  static String currency(num value, {String symbol = r'$'});\n  static String percentage(num value, {int decimals = 1});\n  static String date(DateTime date, {String pattern = 'MMM dd, yyyy'});\n  static String time(DateTime time, {bool is24Hour = false});\n  static String dateTime(DateTime dateTime);\n  static String duration(Duration duration);\n  static String steps(int count); // e.g., \"10,234 steps\"\n  static String distance(double meters); // e.g., \"5.2 km\" or \"3.2 mi\"\n}\n```\n\n**lib/core/utils/extensions.dart:**\n```dart\nextension StringExtensions on String {\n  String get capitalized;\n  String get titleCase;\n  bool get isValidEmail;\n  bool get isNumeric;\n}\n\nextension DateTimeExtensions on DateTime {\n  bool get isToday;\n  bool get isYesterday;\n  bool get isThisWeek;\n  String get timeAgo;\n  DateTime get startOfDay;\n  DateTime get endOfDay;\n}\n\nextension BuildContextExtensions on BuildContext {\n  ThemeData get theme;\n  TextTheme get textTheme;\n  ColorScheme get colorScheme;\n  Size get screenSize;\n  bool get isSmallScreen;\n  void showSnackBar(String message);\n}\n\nextension ListExtensions<T> on List<T> {\n  T? get firstOrNull;\n  T? get lastOrNull;\n}\n```\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Do NOT hardcode validation messages - make them configurable\n- Do NOT use deprecated Navigator.of(context) patterns when helpers exist\n- Do NOT forget null safety in validators\n- Do NOT create actual screens - use Placeholder() widget for all routes\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- All named routes defined in RouteNames class\n- AppRouter.onGenerateRoute handles all routes (returns Placeholder for unimplemented)\n- Unknown routes show user-friendly error page\n- Validators return null for valid input, error message string for invalid\n- Formatters handle localization-ready number/date formatting\n- Extensions provide convenient access to theme and common operations\n\nüß™ **VERIFICATION:**\n```bash\nflutter analyze lib/core/router/ lib/core/utils/\nflutter test --no-pub\n```\n- Verify Validators.email returns null for valid emails, error for invalid\n- Verify Formatters.steps(10234) returns '10,234 steps'",
        "epicId": "epic-ui-foundation",
        "priority": 1,
        "estimatedComplexity": "moderate",
        "dependencies": [],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/app_constants.dart",
          "lib/core/constants/api_endpoints.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/router/route_names.dart",
          "lib/core/router/app_router.dart",
          "lib/core/utils/validators.dart",
          "lib/core/utils/formatters.dart",
          "lib/core/utils/extensions.dart"
        ],
        "acceptanceCriteria": [
          "Given RouteNames class, When accessed, Then it provides all route constants for auth (splash, login, register, forgotPassword) and main app (home, dashboard, profile, settings, steps, groups, leaderboard, goals)",
          "Given AppRouter.onGenerateRoute with valid route name, When called, Then it returns MaterialPageRoute with Placeholder widget",
          "Given AppRouter.onGenerateRoute with unknown route name, When called, Then it returns MaterialPageRoute with _UnknownRoutePage showing error message",
          "Given Validators.email with 'test@example.com', When called, Then it returns null (valid)",
          "Given Validators.email with 'invalid-email', When called, Then it returns error message string",
          "Given Validators.password with 7 character password, When called, Then it returns error message (min length from AppConstants)",
          "Given Formatters.steps(10234), When called, Then it returns '10,234 steps'",
          "Given 'hello world'.titleCase extension, When accessed, Then it returns 'Hello World'",
          "Given flutter analyze lib/core/router/ lib/core/utils/, When executed, Then no errors or warnings are reported"
        ]
      },
      {
        "id": "epic-ui-foundation-story-4",
        "title": "Create Network Layer with ApiClient and Interceptors in lib/core/network/",
        "description": "**Description:**\nImplement the HTTP networking layer using Dio with interceptors for authentication, logging, and error handling. Integrates with the error handling foundation.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart), [lib/core/constants/api_endpoints.dart](lib/core/constants/api_endpoints.dart), [lib/env/env_config.dart](lib/env/env_config.dart), [lib/core/error/failures.dart](lib/core/error/failures.dart), [lib/core/error/exceptions.dart](lib/core/error/exceptions.dart)\n- Modify: none\n- Create: [lib/core/network/network_info.dart](lib/core/network/network_info.dart), [lib/core/network/api_interceptors.dart](lib/core/network/api_interceptors.dart), [lib/core/network/api_client.dart](lib/core/network/api_client.dart)\n\nüîß **PATTERNS TO USE:**\n- Use `abstract final class` pattern where appropriate\n- Use Dio for HTTP client with proper configuration\n- Use connectivity_plus for network checking\n- Import and use exceptions from lib/core/error/exceptions.dart\n- Reference EnvConfig.apiBaseUrl for base URL\n- Reference AppConstants for timeout durations\n- Use dartz Either type for error handling in responses\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**lib/core/network/network_info.dart:**\n```dart\nimport 'package:connectivity_plus/connectivity_plus.dart';\n\nabstract class NetworkInfo {\n  Future<bool> get isConnected;\n  Stream<bool> get onConnectivityChanged;\n}\n\nclass NetworkInfoImpl implements NetworkInfo {\n  final Connectivity _connectivity;\n  \n  NetworkInfoImpl({Connectivity? connectivity})\n      : _connectivity = connectivity ?? Connectivity();\n  \n  @override\n  Future<bool> get isConnected async {\n    final result = await _connectivity.checkConnectivity();\n    return !result.contains(ConnectivityResult.none);\n  }\n  \n  @override\n  Stream<bool> get onConnectivityChanged {\n    return _connectivity.onConnectivityChanged.map(\n      (results) => !results.contains(ConnectivityResult.none),\n    );\n  }\n}\n```\n\n**lib/core/network/api_interceptors.dart:**\n```dart\nimport 'package:dio/dio.dart';\nimport 'package:logger/logger.dart';\n\nclass AuthInterceptor extends Interceptor {\n  String? _accessToken;\n  \n  void setToken(String? token) => _accessToken = token;\n  void clearToken() => _accessToken = null;\n  \n  @override\n  void onRequest(RequestOptions options, RequestInterceptorHandler handler) {\n    if (_accessToken != null) {\n      options.headers['Authorization'] = 'Bearer $_accessToken';\n    }\n    handler.next(options);\n  }\n}\n\nclass LoggingInterceptor extends Interceptor {\n  final Logger _logger;\n  \n  LoggingInterceptor({Logger? logger}) : _logger = logger ?? Logger();\n  \n  @override\n  void onRequest(RequestOptions options, RequestInterceptorHandler handler) {\n    _logger.d('REQUEST[${options.method}] => PATH: ${options.path}');\n    handler.next(options);\n  }\n  \n  @override\n  void onResponse(Response response, ResponseInterceptorHandler handler) {\n    _logger.d('RESPONSE[${response.statusCode}] => PATH: ${response.requestOptions.path}');\n    handler.next(response);\n  }\n  \n  @override\n  void onError(DioException err, ErrorInterceptorHandler handler) {\n    _logger.e('ERROR[${err.response?.statusCode}] => PATH: ${err.requestOptions.path}');\n    handler.next(err);\n  }\n}\n\nclass ErrorInterceptor extends Interceptor {\n  @override\n  void onError(DioException err, ErrorInterceptorHandler handler) {\n    // Transform DioException to app-specific exceptions\n    // Will be handled by ApiClient\n    handler.next(err);\n  }\n}\n```\n\n**lib/core/network/api_client.dart:**\n```dart\nimport 'package:dio/dio.dart';\nimport 'package:dartz/dartz.dart';\nimport '../error/exceptions.dart';\nimport '../error/failures.dart';\nimport '../constants/app_constants.dart';\nimport '../../env/env_config.dart';\nimport 'api_interceptors.dart';\nimport 'network_info.dart';\n\nclass ApiClient {\n  late final Dio _dio;\n  final NetworkInfo _networkInfo;\n  final AuthInterceptor _authInterceptor;\n  \n  ApiClient({\n    required NetworkInfo networkInfo,\n    Dio? dio,\n  }) : _networkInfo = networkInfo,\n       _authInterceptor = AuthInterceptor() {\n    _dio = dio ?? Dio();\n    _configureDio();\n  }\n  \n  void _configureDio() {\n    _dio.options = BaseOptions(\n      baseUrl: EnvConfig.apiBaseUrl,\n      connectTimeout: AppConstants.connectionTimeout,\n      receiveTimeout: AppConstants.receiveTimeout,\n      headers: {'Content-Type': 'application/json'},\n    );\n    \n    _dio.interceptors.addAll([\n      _authInterceptor,\n      if (EnvConfig.enableLogging) LoggingInterceptor(),\n      ErrorInterceptor(),\n    ]);\n  }\n  \n  void setAuthToken(String? token) => _authInterceptor.setToken(token);\n  void clearAuthToken() => _authInterceptor.clearToken();\n  \n  Future<Either<Failure, T>> request<T>({\n    required String path,\n    required String method,\n    Map<String, dynamic>? queryParameters,\n    dynamic data,\n    required T Function(dynamic) parser,\n  }) async {\n    if (!await _networkInfo.isConnected) {\n      return Left(NetworkFailure(message: 'No internet connection'));\n    }\n    \n    try {\n      final response = await _dio.request(\n        path,\n        options: Options(method: method),\n        queryParameters: queryParameters,\n        data: data,\n      );\n      return Right(parser(response.data));\n    } on DioException catch (e) {\n      return Left(_handleDioError(e));\n    } catch (e) {\n      return Left(UnknownFailure(message: e.toString()));\n    }\n  }\n  \n  Failure _handleDioError(DioException error) {\n    switch (error.response?.statusCode) {\n      case 400: return ValidationFailure(message: 'Bad request');\n      case 401: return AuthenticationFailure(message: 'Unauthorized');\n      case 403: return AuthenticationFailure(message: 'Forbidden');\n      case 404: return ServerFailure(message: 'Not found', code: 404);\n      case 500: return ServerFailure(message: 'Server error', code: 500);\n      default:\n        if (error.type == DioExceptionType.connectionTimeout) {\n          return NetworkFailure(message: 'Connection timeout');\n        }\n        return ServerFailure(message: error.message ?? 'Unknown error');\n    }\n  }\n  \n  // Convenience methods\n  Future<Either<Failure, T>> get<T>(...) => request(method: 'GET', ...);\n  Future<Either<Failure, T>> post<T>(...) => request(method: 'POST', ...);\n  Future<Either<Failure, T>> put<T>(...) => request(method: 'PUT', ...);\n  Future<Either<Failure, T>> delete<T>(...) => request(method: 'DELETE', ...);\n}\n```\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Do NOT throw exceptions from ApiClient - always return Either<Failure, T>\n- Do NOT hardcode base URL - use EnvConfig.apiBaseUrl\n- Do NOT hardcode timeouts - use AppConstants\n- Do NOT skip network connectivity check before requests\n- Do NOT forget to import error types from lib/core/error/\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- NetworkInfo provides connectivity status and change stream\n- AuthInterceptor adds Bearer token to all requests when set\n- LoggingInterceptor logs requests/responses when EnvConfig.enableLogging is true\n- ApiClient returns Either<Failure, T> for all requests\n- ApiClient checks network connectivity before making requests\n- Proper error mapping from HTTP status codes to Failure types\n\nüß™ **VERIFICATION:**\n```bash\nflutter analyze lib/core/network/\nflutter test --no-pub\n```\n- Verify ApiClient compiles with all imports resolved\n- Verify NetworkInfo can check connectivity",
        "epicId": "epic-ui-foundation",
        "priority": 2,
        "estimatedComplexity": "moderate",
        "dependencies": [
          "epic-ui-foundation-story-1"
        ],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/app_constants.dart",
          "lib/core/constants/api_endpoints.dart",
          "lib/env/env_config.dart",
          "lib/core/error/failures.dart",
          "lib/core/error/exceptions.dart"
        ],
        "filesToModify": [],
        "filesToCreate": [
          "lib/core/network/network_info.dart",
          "lib/core/network/api_interceptors.dart",
          "lib/core/network/api_client.dart"
        ],
        "acceptanceCriteria": [
          "Given NetworkInfoImpl, When isConnected is called with network available, Then it returns true",
          "Given NetworkInfoImpl, When onConnectivityChanged is subscribed, Then it emits boolean values on connectivity changes",
          "Given AuthInterceptor with token set, When request is made, Then Authorization header contains 'Bearer {token}'",
          "Given ApiClient with no network, When request is made, Then it returns Left(NetworkFailure)",
          "Given ApiClient with network and successful response, When request is made, Then it returns Right(parsedData)",
          "Given ApiClient with 401 response, When request is made, Then it returns Left(AuthenticationFailure)",
          "Given ApiClient with 500 response, When request is made, Then it returns Left(ServerFailure) with code 500",
          "Given flutter analyze lib/core/network/, When executed, Then no errors or warnings are reported"
        ]
      },
      {
        "id": "epic-ui-foundation-story-5",
        "title": "Create Core Widgets Library and App Bootstrap in lib/core/widgets/, lib/core/di/, lib/main.dart, lib/app.dart",
        "description": "**Description:**\nImplement the reusable widget library, dependency injection container, and app entry point. This ties together all foundation layers into a runnable application.\n\nüîí **SCOPE BOUNDARY:**\n- You can ONLY create/modify files listed below\n- Creating ANY other file is a scope violation\n\nüìÅ **FILES:**\n- Read: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart), [lib/core/theme/app_theme.dart](lib/core/theme/app_theme.dart), [lib/core/theme/app_colors.dart](lib/core/theme/app_colors.dart), [lib/core/router/app_router.dart](lib/core/router/app_router.dart), [lib/core/router/route_names.dart](lib/core/router/route_names.dart), [lib/core/network/api_client.dart](lib/core/network/api_client.dart), [lib/core/network/network_info.dart](lib/core/network/network_info.dart), [lib/env/env_config.dart](lib/env/env_config.dart)\n- Modify: [lib/core/constants/app_constants.dart](lib/core/constants/app_constants.dart)\n- Create: [lib/core/widgets/app_button.dart](lib/core/widgets/app_button.dart), [lib/core/widgets/app_text_field.dart](lib/core/widgets/app_text_field.dart), [lib/core/widgets/app_card.dart](lib/core/widgets/app_card.dart), [lib/core/widgets/app_loading.dart](lib/core/widgets/app_loading.dart), [lib/core/widgets/app_error.dart](lib/core/widgets/app_error.dart), [lib/core/widgets/app_empty_state.dart](lib/core/widgets/app_empty_state.dart), [lib/core/widgets/app_avatar.dart](lib/core/widgets/app_avatar.dart), [lib/core/widgets/app_bottom_nav.dart](lib/core/widgets/app_bottom_nav.dart), [lib/core/di/injection_container.dart](lib/core/di/injection_container.dart), [lib/main.dart](lib/main.dart), [lib/app.dart](lib/app.dart)\n\nüîß **PATTERNS TO USE:**\n- Use get_it for dependency injection (already in pubspec.yaml)\n- Use `abstract final class` pattern where appropriate\n- Use theme from AppTheme in all widgets\n- Widgets should be stateless where possible, use hooks pattern for state\n- Import and use existing app infrastructure (theme, router, network, etc.)\n\nüì¶ **REQUIRED IMPLEMENTATION:**\n\n**lib/core/widgets/app_button.dart:**\n```dart\nenum AppButtonVariant { primary, secondary, outline, text }\nenum AppButtonSize { small, medium, large }\n\nclass AppButton extends StatelessWidget {\n  final String label;\n  final VoidCallback? onPressed;\n  final AppButtonVariant variant;\n  final AppButtonSize size;\n  final bool isLoading;\n  final bool isFullWidth;\n  final IconData? icon;\n  \n  const AppButton({\n    required this.label,\n    this.onPressed,\n    this.variant = AppButtonVariant.primary,\n    this.size = AppButtonSize.medium,\n    this.isLoading = false,\n    this.isFullWidth = false,\n    this.icon,\n    super.key,\n  });\n  \n  // Factory constructors for convenience\n  factory AppButton.primary({...});\n  factory AppButton.secondary({...});\n  factory AppButton.outline({...});\n  factory AppButton.text({...});\n}\n```\n\n**lib/core/widgets/app_text_field.dart:**\n```dart\nclass AppTextField extends StatelessWidget {\n  final String? label;\n  final String? hint;\n  final String? errorText;\n  final TextEditingController? controller;\n  final String? Function(String?)? validator;\n  final TextInputType keyboardType;\n  final bool obscureText;\n  final bool enabled;\n  final int maxLines;\n  final Widget? prefixIcon;\n  final Widget? suffixIcon;\n  final void Function(String)? onChanged;\n  final void Function(String)? onSubmitted;\n  \n  const AppTextField({...});\n  \n  // Factory constructors\n  factory AppTextField.email({...});\n  factory AppTextField.password({...});\n  factory AppTextField.search({...});\n}\n```\n\n**lib/core/widgets/app_card.dart:**\n```dart\nclass AppCard extends StatelessWidget {\n  final Widget child;\n  final EdgeInsets? padding;\n  final VoidCallback? onTap;\n  final Color? backgroundColor;\n  final double elevation;\n  final BorderRadius? borderRadius;\n  \n  const AppCard({...});\n}\n```\n\n**lib/core/widgets/app_loading.dart:**\n```dart\nclass AppLoading extends StatelessWidget {\n  final String? message;\n  final double size;\n  final Color? color;\n  \n  const AppLoading({...});\n  const AppLoading.small({...});\n  const AppLoading.fullScreen({...});\n}\n```\n\n**lib/core/widgets/app_error.dart:**\n```dart\nclass AppError extends StatelessWidget {\n  final String message;\n  final String? details;\n  final VoidCallback? onRetry;\n  final IconData icon;\n  \n  const AppError({...});\n  const AppError.network({...});\n  const AppError.server({...});\n}\n```\n\n**lib/core/widgets/app_empty_state.dart:**\n```dart\nclass AppEmptyState extends StatelessWidget {\n  final String title;\n  final String? description;\n  final IconData? icon;\n  final String? actionLabel;\n  final VoidCallback? onAction;\n  \n  const AppEmptyState({...});\n}\n```\n\n**lib/core/widgets/app_avatar.dart:**\n```dart\nclass AppAvatar extends StatelessWidget {\n  final String? imageUrl;\n  final String? initials;\n  final double size;\n  final Color? backgroundColor;\n  final VoidCallback? onTap;\n  \n  const AppAvatar({...});\n  const AppAvatar.small({...});\n  const AppAvatar.large({...});\n}\n```\n\n**lib/core/widgets/app_bottom_nav.dart:**\n```dart\nclass AppBottomNav extends StatelessWidget {\n  final int currentIndex;\n  final void Function(int) onTap;\n  \n  const AppBottomNav({...});\n  \n  // Navigation items: Home, Steps, Groups, Leaderboard, Profile\n}\n```\n\n**lib/core/di/injection_container.dart:**\n```dart\nimport 'package:get_it/get_it.dart';\n\nfinal sl = GetIt.instance; // Service Locator\n\nFuture<void> initDependencies() async {\n  // Core\n  sl.registerLazySingleton<NetworkInfo>(() => NetworkInfoImpl());\n  sl.registerLazySingleton<ApiClient>(\n    () => ApiClient(networkInfo: sl()),\n  );\n  \n  // Services will be registered by feature epics\n  // Repositories will be registered by feature epics\n  // BLoCs will be registered by feature epics\n}\n```\n\n**lib/main.dart:**\n```dart\nimport 'package:flutter/material.dart';\nimport 'package:flutter_dotenv/flutter_dotenv.dart';\nimport 'app.dart';\nimport 'core/di/injection_container.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  \n  // Load environment variables\n  await dotenv.load(fileName: '.env');\n  \n  // Initialize dependencies\n  await initDependencies();\n  \n  runApp(const AppPasos());\n}\n```\n\n**lib/app.dart:**\n```dart\nimport 'package:flutter/material.dart';\nimport 'core/theme/app_theme.dart';\nimport 'core/router/app_router.dart';\nimport 'core/router/route_names.dart';\nimport 'core/constants/app_constants.dart';\n\nclass AppPasos extends StatelessWidget {\n  const AppPasos({super.key});\n  \n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: AppConstants.appName,\n      debugShowCheckedModeBanner: false,\n      theme: AppTheme.lightTheme,\n      darkTheme: AppTheme.darkTheme,\n      themeMode: ThemeMode.system,\n      navigatorKey: AppRouter.navigatorKey,\n      onGenerateRoute: AppRouter.onGenerateRoute,\n      initialRoute: RouteNames.splash,\n    );\n  }\n}\n```\n\n**MODIFY lib/core/constants/app_constants.dart:**\nAdd new constants:\n```dart\n// Add to existing AppConstants class:\n\n/// Default avatar size in logical pixels.\nstatic const double defaultAvatarSize = 40.0;\n\n/// Small avatar size in logical pixels.\nstatic const double smallAvatarSize = 32.0;\n\n/// Large avatar size in logical pixels.\nstatic const double largeAvatarSize = 64.0;\n\n/// Default border radius for cards and containers.\nstatic const double defaultBorderRadius = 12.0;\n\n/// Default padding for cards and containers.\nstatic const double defaultPadding = 16.0;\n\n/// Default spacing between elements.\nstatic const double defaultSpacing = 8.0;\n```\n\n‚ö†Ô∏è **ANTI-PATTERNS TO AVOID:**\n- Do NOT hardcode colors in widgets - use Theme.of(context) or AppColors\n- Do NOT hardcode text styles - use Theme.of(context).textTheme\n- Do NOT create stateful widgets when stateless works\n- Do NOT use late initialization where constructor injection works\n- Do NOT forget to import dependencies from other stories\n\nüéØ **FUNCTIONAL REQUIREMENTS:**\n- All widgets use theme from context (Material 3 compliant)\n- All widgets are accessible (semantic labels, sufficient contrast)\n- AppButton shows loading indicator when isLoading is true\n- AppTextField integrates with form validation\n- AppError has retry button when onRetry is provided\n- DI container initializes NetworkInfo and ApiClient\n- App launches with splash route\n- Theme mode follows system preference\n\nüß™ **VERIFICATION:**\n```bash\nflutter analyze\nflutter build apk --debug\nflutter test --no-pub\n```\n- Verify app builds successfully\n- Verify flutter analyze shows no errors\n- Verify app launches to splash screen placeholder",
        "epicId": "epic-ui-foundation",
        "priority": 3,
        "estimatedComplexity": "complex",
        "dependencies": [
          "epic-ui-foundation-story-2",
          "epic-ui-foundation-story-3",
          "epic-ui-foundation-story-4"
        ],
        "status": "pending",
        "filesToRead": [
          "lib/core/constants/app_constants.dart",
          "lib/core/theme/app_theme.dart",
          "lib/core/theme/app_colors.dart",
          "lib/core/router/app_router.dart",
          "lib/core/router/route_names.dart",
          "lib/core/network/api_client.dart",
          "lib/core/network/network_info.dart",
          "lib/env/env_config.dart"
        ],
        "filesToModify": [
          "lib/core/constants/app_constants.dart"
        ],
        "filesToCreate": [
          "lib/core/widgets/app_button.dart",
          "lib/core/widgets/app_text_field.dart",
          "lib/core/widgets/app_card.dart",
          "lib/core/widgets/app_loading.dart",
          "lib/core/widgets/app_error.dart",
          "lib/core/widgets/app_empty_state.dart",
          "lib/core/widgets/app_avatar.dart",
          "lib/core/widgets/app_bottom_nav.dart",
          "lib/core/di/injection_container.dart",
          "lib/main.dart",
          "lib/app.dart"
        ],
        "acceptanceCriteria": [
          "Given AppButton with isLoading=true, When rendered, Then it shows CircularProgressIndicator instead of label",
          "Given AppButton.primary factory, When created, Then it uses primary color from theme",
          "Given AppTextField.password factory, When created, Then obscureText is true and has visibility toggle icon",
          "Given AppError with onRetry callback, When rendered, Then it shows retry button that calls onRetry when pressed",
          "Given AppLoading.fullScreen, When rendered, Then it covers entire screen with centered loading indicator",
          "Given AppEmptyState with actionLabel and onAction, When rendered, Then it shows action button that triggers onAction",
          "Given AppAvatar with imageUrl, When rendered, Then it shows network image with fallback to initials",
          "Given AppBottomNav, When item is tapped, Then onTap is called with correct index",
          "Given injection_container initDependencies(), When called, Then NetworkInfo and ApiClient are registered in GetIt",
          "Given main.dart, When app starts, Then it loads .env, initializes DI, and runs AppPasos widget",
          "Given AppPasos widget, When built, Then MaterialApp uses AppTheme.lightTheme, darkTheme, and AppRouter",
          "Given flutter analyze, When executed on full project, Then no errors or warnings are reported",
          "Given flutter build apk --debug, When executed, Then build succeeds without errors"
        ]
      }
    ]
  }
}