{
  "_metadata": {
    "agentType": "planning",
    "taskId": "988f41f1cbb1c253ca4db879",
    "timestamp": "2026-02-02T00:48:07.678Z",
    "phase": "Sandbox",
    "savedAt": "2026-02-02T00:48:07.678Z",
    "version": "1.0"
  },
  "data": {
    "taskTitle": "fnnn213",
    "taskDescription": "CONTEXT:\nApp Pasos is a step tracking mobile app built with Flutter (frontend) and Node.js/Express/MongoDB (backend). \nThe core architecture exists but lacks differentiating features and production polish.\n\nCurrent state:\n- Frontend: Flutter with BLoC, Clean Architecture, 7 feature modules (auth, dashboard, goals, profile, settings, sharing, splash)\n- Backend: Express + MongoDB + Socket.io with models for User, Step, GroupGoal, SharingRelationship\n- Both have Docker configs ready\n\nOBJECTIVE:\nTransform App Pasos from a generic step tracker into a production-ready app with gamification and social features that differentiate it from native health apps.\n\nREQUIREMENTS:\n\n## 1. GAMIFICATION SYSTEM (Backend + Frontend)\n\n### Backend:\n- Create Achievement model with fields: id, name, description, icon, category (steps|streak|social), requirement (JSON with conditions), points, rarity (common|rare|epic|legendary)\n- Create UserAchievement model: userId, achievementId, unlockedAt, progress\n- Create UserStats model: userId, totalSteps, longestStreak, currentStreak, weeklyAverage, level, xp, rank\n- Add achievements.routes.ts with endpoints:\n  - GET /achievements (list all)\n  - GET /achievements/user/:userId (user's unlocked)\n  - POST /achievements/check (evaluate and unlock)\n- Add gamification.service.ts that:\n  - Calculates XP from steps (1 XP per 100 steps)\n  - Calculates level from XP (level = floor(sqrt(xp/100)))\n  - Evaluates achievement conditions after each step sync\n  - Emits socket event on achievement unlock\n\n### Frontend:\n- Create lib/features/achievements/ with Clean Architecture\n- AchievementCard widget showing icon, name, progress bar, rarity badge\n- AchievementsPage with tabs: All, Unlocked, In Progress\n- Achievement unlock animation (confetti + modal)\n- Add achievement notifications via Firebase\n- Show level and XP in profile page with progress bar to next level\n\n### Seed Achievements (create migration):\n- \"First Steps\" - Record 1000 steps (common)\n- \"Week Warrior\" - 7-day streak (common)  \n- \"Marathon Month\" - 100K steps in a month (rare)\n- \"Social Butterfly\" - Share with 5 friends (rare)\n- \"Iron Will\" - 30-day streak (epic)\n- \"Million Miles\" - 1M lifetime steps (legendary)\n\n## 2. CHALLENGES SYSTEM (Backend + Frontend)\n\n### Backend:\n- Create Challenge model: id, name, description, type (individual|group), goal (steps), duration (days), startDate, endDate, creatorId, status (upcoming|active|completed)\n- Create ChallengeParticipant model: challengeId visibleaUserId, progress, joinedAt, rank\n- Add challenges.routes.ts:\n  - POST /challenges (create)\n  - GET /challenges (list active/upcoming)\n  - POST /challenges/:id/join\n  - GET /challenges/:id/leaderboard\n- Socket events for real-time leaderboard updates\n\n### Frontend:\n- Create lib/features/challenges/\n- ChallengeCard showing name, progress, time remaining, participant count\n- ChallengePage with leaderboard, your position highlighted\n- CreateChallengePage form\n- Join challenge flow with confirmation\n\n## 3. INSIGHTS & ANALYTICS (Backend + Frontend)\n\n### Backend:\n- Add insights.service.ts that calculates:\n  - Daily/weekly/monthly trends\n  - Best/worst days of week\n  - Comparison vs previous period\n  - Projected monthly total\n- Add GET /users/:id/insights endpoint\n\n### Frontend:\n- Create lib/features/insights/\n- InsightsPage with:\n  - Line chart: Last 7/30/90 days trend (use fl_chart)\n  - Bar chart: Steps by day of week\n  - Stat cards: \"You walk 23% more on weekends\"\n  - Goal projection: \"At this pace, you'll hit 300K this month\"\n\n## 4. PRODUCTION POLISH\n\n### Backend:\n- Add request validation to all endpoints using express-validator\n- Add proper error codes and messages\n- Add rate limiting per user (not just IP)\n- Add API versioning (/api/v1/)\n- Add Swagger documentation for all new endpoints\n- Add health check endpoint with DB status\n- Configure Sentry for error tracking\n- Add database indexes for performance\n\n### Frontend:\n- Add offline support: queue step syncs when offline, sync when online\n- Add pull-to-refresh on all list screens\n- Add empty states for all lists\n- Add loading skeletons (shimmer effect)\n- Add haptic feedback on achievements\n- Add app icon and splash screen assets\n- Add onboarding flow (3 screens explaining features)\n- Configure deep links for challenge invites\n- Test and fix on iOS and Android\n\n### Both:\n- Environment configs for dev/staging/prod\n- CI/CD pipeline config (GitHub Actions)\n- Add comprehensive error handling\n- Add logging with correlation IDs\n\n## 5. TESTING\n\n### Backend:\n- Integration tests for achievements endpoints\n- Integration tests for challenges endpoints\n- Unit tests for gamification calculations\n\n### Frontend:\n- Widget tests for new components\n- BLoC tests for new features\n\nCONSTRAINTS:\n- Maintain existing Clean Architecture pattern\n- Use existing tech stack (no new major dependencies unless necessary)\n- All new endpoints must have Swagger docs\n- All new features must have tests\n- Mobile-first design\n- Support iOS 13+ and Android 8+\n\nACCEPTANCE CRITERIA:\n- All features working end-to-end\n- No TypeScript/Dart errors\n- All tests passing\n- Swagger docs complete\n- App builds successfully for iOS and Android\n- Docker compose runs both services",
    "startedAt": "2026-02-02T00:47:18.459Z",
    "currentPhase": "Sandbox",
    "phasesCompleted": [],
    "epics": [],
    "totalCost": 0,
    "totalTokens": 0,
    "lastUpdated": "2026-02-02T00:48:07.678Z"
  }
}